<?php
 namespace app\index\controller; use think\Controller; use think\Log; use think\Debug; use think\Request; use think\Db; use app\index\service\Authorize as AuthorizeService; use app\index\logic\AdminRole as AdminRoleLogic; class AdminRole extends Common { public function adminRole($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto lvlQb; lvlQb: if (!request()->isGet()) { goto JR987; } goto zjTxI; S3z1Z: $this->assign("\x75\x72\154\110\x72\x65\146\163", $urlHrefs); goto cgiGR; cgiGR: return $this->fetch(); goto hJmIQ; zjTxI: $urlHrefs = ["\x61\144\x6d\151\x6e\122\x6f\154\145" => url("\x69\x6e\x64\x65\170\x2f\x41\x64\155\151\156\122\x6f\x6c\145\57\x61\x64\x6d\151\156\122\x6f\154\145"), "\x73\x61\166\145" => url("\x69\156\x64\145\x78\57\101\144\155\151\156\x52\x6f\x6c\x65\57\163\141\166\x65"), "\x64\145\x6c\x65\164\x65" => url("\151\156\x64\x65\x78\x2f\x41\x64\x6d\x69\x6e\122\x6f\x6c\145\57\x64\145\154\145\x74\x65"), "\x61\165\x74\150\157\x72\151\172\x65" => url("\x69\x6e\x64\x65\x78\x2f\101\x64\155\151\x6e\x52\157\154\x65\x2f\141\165\164\150\x6f\x72\x69\x7a\x65")]; goto S3z1Z; hJmIQ: JR987: goto kio71; kio71: return json(AdminRoleLogic::I()->load($search, $page, $rows, $sort, $order)); goto gHCJs; gHCJs: } public function save($roleId) { goto uR88w; pdXh3: return $this->fetch("\x63\157\x6d\155\x6f\156\57\x65\162\162\x6f\162"); goto KHLNQ; ByqHf: return $this->fetch(); goto bd5CC; BrrhZ: Guygq: goto SRvi9; kIQS_: if ($infos) { goto lRqh4; } goto pdXh3; KHLNQ: lRqh4: goto me4qe; o40_2: if ($roleId) { goto Guygq; } goto HgoEi; HgoEi: $infos = AdminRoleLogic::I()->getDefault(); goto rLSnh; SBS8f: $bindValues = ["\x69\156\146\157\163" => $infos]; goto HZTxP; HZTxP: $this->assign("\x62\x69\156\144\x56\141\x6c\x75\145\x73", $bindValues); goto ByqHf; PxUA8: $infos = input("\x70\157\x73\x74\56\x69\156\146\157\163\57\141"); goto Ar0S8; Ar0S8: try { AdminRoleLogic::I()->save($roleId, $infos); return ajaxSuccess("\xe6\x93\x8d\xe4\275\x9c\xe6\210\x90\345\212\x9f"); } catch (\Exception $e) { return ajaxError($e->getMessage()); } goto Bbmhj; bd5CC: UtwXj: goto PxUA8; uR88w: if (!request()->isGet()) { goto UtwXj; } goto o40_2; me4qe: a0dsk: goto SBS8f; SRvi9: $infos = AdminRoleLogic::I()->get($roleId); goto kIQS_; rLSnh: goto a0dsk; goto BrrhZ; Bbmhj: } public function delete($roleId) { try { AdminRoleLogic::I()->delete($roleId); return ajaxSuccess("\346\223\215\344\xbd\x9c\346\x88\220\xe5\212\x9f"); } catch (\Exception $e) { return ajaxError($e->getMessage()); } } public function authorize($roleId) { goto iw090; WtE85: F0_4i: goto TkYXz; KtoqY: $this->assign("\142\151\x6e\x64\126\x61\x6c\165\145\163", $bindValues); goto ssw42; FGQ2s: $this->assign("\x75\x72\154\x48\x72\145\x66\163", $urlHrefs); goto aiYlf; ar4cR: return ajaxSuccess("\xe6\223\215\344\xbd\x9c\346\210\x90\xe5\212\x9f"); goto jn3Pt; aiYlf: $infos = Db::table("\141\144\155\151\156\x5f\162\x6f\154\x65")->where("\x72\x6f\x6c\145\x5f\x69\x64", $roleId)->field(true)->find(); goto PBNsr; iw090: if (!request()->isGet()) { goto ZRFaE; } goto n6hm3; c2fW4: ZRFaE: goto nhuIQ; nhuIQ: AuthorizeService::I()->editRoleAuth($roleId, input("\160\x6f\x73\x74\56")); goto ar4cR; TkYXz: $bindValues = ["\151\x6e\146\157\x73" => $infos]; goto KtoqY; n6hm3: $urlHrefs = ["\162\x6f\154\145\x4e\157\144\145\163" => url("\151\156\x64\145\x78\57\101\144\x6d\x69\156\122\x6f\x6c\145\57\162\x6f\154\145\x41\x75\x74\x68\124\162\x65\145\x4e\157\144\145\163", ["\x72\157\x6c\145\x49\144" => $roleId])]; goto FGQ2s; PBNsr: if ($infos) { goto F0_4i; } goto GsRxr; GsRxr: return $this->fetch("\143\157\x6d\x6d\157\x6e\x2f\145\x72\162\x6f\x72"); goto WtE85; ssw42: return $this->fetch(); goto c2fW4; jn3Pt: } protected function loadLeftMenuRecursively($roleId, $pid, &$nodes) { goto kgmQb; KrY16: if (!empty($rows)) { goto LTSTT; } goto eIaiH; kgmQb: $rows = Db::table("\x6d\145\x6e\x75")->where(array("\x70\151\144" => $pid))->field("\x69\144\x2c\160\151\x64\x2c\154\145\x76\x65\154\x2c\156\x61\x6d\145\x2c\151\x63\x6f\x6e\137\x63\154\x73\x2c\143\54\x61\x2c\x70\141\162\141\x6d\163")->order("\157\x72\144\x65\x72\137\151\144\x20\x41\x53\x43")->select(); goto KrY16; eIaiH: return; goto essNq; Qpg2e: foreach ($rows as $key => $value) { goto wfMpr; RFnhV: a0OtY: goto yD2ET; rBXQ8: if (!empty($subNodes)) { goto PjEN1; } goto NYqUH; sPScd: $finalNode = array(array("\x69\x64" => $id . "\x5f" . AuthorizeService::AUTHORIZE_READ_ONLY_TYPE, "\x74\x65\x78\x74" => "\345\217\xaa\350\257\xbb", "\151\x63\x6f\156\103\154\163" => "\x66\141\x20\x66\x61\55\x65\x79\x65", "\143\x68\145\x63\x6b\145\x64" => true), array("\151\144" => $id . "\137" . AuthorizeService::AUTHORIZE_READ_WRITE_TYPE, "\164\145\170\x74" => "\350\xaf\273\xe5\x86\x99", "\x69\x63\157\x6e\x43\154\x73" => "\146\141\x20\146\141\55\x70\x65\x6e\x63\x69\x6c")); goto ZIXSj; HGKGz: if ($roleMenu["\164\x79\160\x65"] == AuthorizeService::AUTHORIZE_READ_WRITE_TYPE) { goto pgeeX; } goto OrSSz; xfgCB: $node["\x74\x65\170\164"] = $value["\x6e\x61\155\x65"]; goto zT11A; n3nIu: if ($roleMenu) { goto lAIbs; } goto rp24P; imWZq: if ($roleMenu["\x74\171\160\145"] == AuthorizeService::AUTHORIZE_READ_ONLY_TYPE) { goto J8Tan; } goto HGKGz; YLbis: $node["\151\x64"] = ''; goto n3nIu; yD2ET: $nodes[] = $node; goto EC4En; GvX33: $this->loadLeftMenuRecursively($roleId, $id, $subNodes); goto rBXQ8; W37lc: goto a0OtY; goto wqpAu; aNjS0: $node["\x63\x68\x69\x6c\144\x72\145\x6e"] = $finalNode; goto HLVdA; JYOVx: $subNodes = array(); goto GvX33; HplXq: pgeeX: goto yqcv4; yqcv4: $finalNode = array(array("\151\144" => $id . "\x5f" . AuthorizeService::AUTHORIZE_READ_ONLY_TYPE, "\164\145\170\164" => "\xe5\217\252\xe8\xaf\xbb", "\x69\x63\157\x6e\103\x6c\x73" => "\x66\x61\40\x66\x61\55\x65\171\x65"), array("\x69\x64" => $id . "\x5f" . AuthorizeService::AUTHORIZE_READ_WRITE_TYPE, "\164\145\x78\x74" => "\350\xaf\273\xe5\206\231", "\x69\x63\157\x6e\x43\x6c\163" => "\x66\141\x20\146\x61\x2d\160\145\156\x63\x69\154", "\143\x68\x65\x63\153\145\144" => true)); goto VARS_; VARS_: NsE5r: goto aNjS0; NYqUH: $roleMenu = AuthorizeService::I()->check($roleId, $id); goto YLbis; wfMpr: $id = $value["\151\144"]; goto Dm0Rl; zT11A: $node["\151\143\x6f\156\x43\x6c\x73"] = $value["\151\143\157\156\137\x63\154\x73"]; goto JYOVx; fDcpH: $node["\143\x68\x69\154\144\162\145\x6e"] = $subNodes; goto RFnhV; Dm0Rl: $node = array(); goto MmZj1; EC4En: OLB0e: goto kc5kr; OrSSz: goto NsE5r; goto dYvKu; fltEa: goto AzmCA; goto eSMGP; rp24P: $node["\143\150\x69\154\x64\162\145\156"] = array(array("\151\x64" => $id . "\137" . AuthorizeService::AUTHORIZE_READ_ONLY_TYPE, "\x74\145\x78\x74" => "\345\x8f\252\xe8\xaf\273", "\x69\143\157\156\x43\x6c\x73" => "\x66\141\40\146\x61\55\145\171\145"), array("\x69\144" => $id . "\137" . AuthorizeService::AUTHORIZE_READ_WRITE_TYPE, "\x74\145\170\164" => "\350\257\273\345\206\x99", "\151\143\x6f\x6e\x43\154\163" => "\x66\141\40\x66\141\x2d\160\x65\x6e\x63\151\x6c")); goto fltEa; EKoca: $node["\x6e\x61\155\x65"] = $value["\x6e\x61\x6d\x65"]; goto xfgCB; MmZj1: $node["\151\144"] = $id; goto EKoca; eSMGP: lAIbs: goto imWZq; wqpAu: PjEN1: goto fDcpH; dYvKu: J8Tan: goto sPScd; HLVdA: AzmCA: goto W37lc; ZIXSj: goto NsE5r; goto HplXq; kc5kr: } goto wf3Gv; essNq: LTSTT: goto Qpg2e; wf3Gv: OTPv4: goto OSQcI; OSQcI: } public function roleAuthTreeNodes($roleId) { goto UBSus; UBSus: $nodes = array(); goto gey0d; K1hke: return json($returnRows); goto aObBU; gey0d: $this->loadLeftMenuRecursively($roleId, 0, $nodes); goto y5zlt; y5zlt: $returnRows = [["\x69\x64" => "\x30", "\x74\145\170\x74" => "\xe6\xa0\271\350\212\202\347\x82\xb9", "\151\x63\x6f\156\103\x6c\163" => "\146\141\40\146\x61\55\x6e\x61\x76\x69\x63\157\x6e", "\x63\x68\151\x6c\x64\162\x65\x6e" => $nodes]]; goto K1hke; aObBU: } }
