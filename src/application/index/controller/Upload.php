<?php
 namespace app\index\controller; use app\index\Defs as IndexDefs; use app\index\model\Attachments; use think\image\Exception; use think\Log; use think\Debug; use think\Db; use think\File; use think\Image; use app\index\service\EventLogs; use app\Defs; use app\index\logic\Upload as UploadLogic; use app\index\logic\Campaigns as CampaignsLogic; class Upload extends Common { const ATTACHES_UI_BIG_STYLE = 1; const ATTACHES_UI_LIGHT_STYLE = 2; const ATTACHES_UI_TABLE_STYLE = 3; const ATTACHES_UI_DATAGRID_STYLE = 4; const ATTACHES_UI_LINK_STYLE = 5; public function upload() { goto iWbnd; UZGCn: $uploadInfo = $file->getInfo(); goto XQoPq; iCynx: aI2wL: goto KiRvV; vueCZ: lQxKu: goto sRedz; hLk1b: if ($originalError == UPLOAD_ERR_NO_FILE) { goto kGqCR; } goto CqnKb; h8NO4: $errorDesc = "\x55\156\x6b\x6e\x6f\x77\x6e\40\145\x72\x72\x6f\162\x73\56"; goto YyjaQ; tISSa: $errorDesc = "\x4e\x6f\40\x66\151\x6c\x65\40\x73\145\156\164\56"; goto vueCZ; nsLo_: uploadSuccess("\163\x75\x63\x63\145\x73\163", ["\x6f\x72\151\147\151\x6e\x61\154\137\156\141\155\145" => $originalName, "\x73\x61\x76\x65\137\156\x61\x6d\x65" => $saveName, "\165\162\x6c" => $url, "\x72\145\154\x61\164\151\x76\145\137\165\x72\154" => $relativeUrl, "\x61\142\x73\x6f\x6c\x75\164\x65\x5f\x75\162\x6c" => $absoluteUrl]); goto U9oUK; b2A4y: qo9KS: goto ZGkBg; xynN_: uploadError("\146\141\151\x6c\x65\144\40\164\x6f\x20\x67\145\x74\x20\x74\150\145\40\165\x70\154\157\141\144\x20\146\x69\154\x65"); goto ctGIQ; sRedz: uploadError("\146\141\151\154\145\144\x20\x74\x6f\40\x75\160\x6c\x6f\x61\x64\x20\146\x69\154\145\x2c\x20\143\141\x75\163\145\x3a\40" . $errorDesc); goto OkuaL; keUaA: $originalTmpName = $uploadInfo["\x74\x6d\160\x5f\x6e\141\x6d\x65"]; goto G3joV; ZpzYg: uploadError("\345\244\261\350\xb4\245\40\55\x20" . $file->getError()); goto b2A4y; pLQno: if (!($file == null)) { goto ENc5X; } goto xynN_; la47I: $rules = array_merge(config("\x75\160\x6c\x6f\x61\144"), []); goto GPAnZ; BEIcU: goto lQxKu; goto RJa3A; OkuaL: iwcQY: goto la47I; mBf2B: if (!($fileInfo == null)) { goto qo9KS; } goto ZpzYg; KlMRO: $originalSize = $uploadInfo["\x73\151\172\x65"]; goto keUaA; RJa3A: kGqCR: goto tISSa; nb64E: $url = convertUploadSaveName2FullUrl($saveName); goto uaE9J; KiRvV: $errorDesc = "\105\170\143\145\145\144\x65\144\40\x66\151\x6c\145\x73\x69\x7a\x65\x20\154\x69\155\x69\164\40" . config("\165\160\x6c\157\141\x64\56\163\x69\172\145") . "\56"; goto znZ01; XQoPq: $originalName = $uploadInfo["\156\x61\x6d\x65"]; goto o1mw0; o1mw0: $originalType = $uploadInfo["\164\x79\160\145"]; goto KlMRO; CqnKb: if ($originalError == UPLOAD_ERR_INI_SIZE || $originalError == UPLOAD_ERR_FORM_SIZE) { goto aI2wL; } goto h8NO4; YyjaQ: goto Q6sej; goto iCynx; GPAnZ: $fileInfo = $file->validate($rules)->move(UPLOAD_DIR); goto mBf2B; bdd5S: $errorDesc = ''; goto hLk1b; G3joV: $originalError = $uploadInfo["\x65\x72\162\157\x72"]; goto RkELJ; RkELJ: if (!($originalError != UPLOAD_ERR_OK)) { goto iwcQY; } goto bdd5S; cH17X: $absoluteUrl = convertUploadSaveName2AbsoluteUrl($saveName); goto nsLo_; uaE9J: $relativeUrl = convertUploadSaveName2RelativeUrl($saveName); goto cH17X; znZ01: Q6sej: goto BEIcU; iWbnd: $file = request()->file("\x75\160\x6c\157\x61\144"); goto pLQno; ctGIQ: ENc5X: goto UZGCn; ZGkBg: $saveName = $fileInfo->getSaveName(); goto nb64E; U9oUK: } public function uploadImage() { goto wsHMG; wsHMG: $file = request()->file("\x75\x70\x6c\x6f\141\144"); goto RnDln; T6zZT: if ($originalError == UPLOAD_ERR_NO_FILE) { goto aH3rK; } goto SpjlR; F3bv9: $errorDesc = ''; goto T6zZT; QjdW1: ot59o: goto bo16t; jgdaJ: $errorDesc = "\125\x6e\153\156\157\x77\x6e\40\x65\162\162\157\162\x73\56"; goto j3gyf; dBopu: $url = convertUploadSaveName2FullUrl($saveName); goto Z8e9u; q8Sy0: $errorDesc = "\116\157\x20\146\151\x6c\x65\x20\x73\145\156\164\56"; goto QjdW1; SpjlR: if ($originalError == UPLOAD_ERR_INI_SIZE || $originalError == UPLOAD_ERR_FORM_SIZE) { goto vIw70; } goto jgdaJ; yy29l: $uploadInfo = $file->getInfo(); goto mZB8r; JfbbY: $originalType = $uploadInfo["\164\171\160\x65"]; goto v5xff; OmeAX: $fileInfo = $file->validate($rules)->move(UPLOAD_DIR); goto HuJlH; v5xff: $originalSize = $uploadInfo["\163\151\x7a\145"]; goto P92Sq; swSzb: goto ot59o; goto n8Ls0; HBi1C: $originalError = $uploadInfo["\145\162\162\157\162"]; goto bWmhp; BWb1d: WThFU: goto YaqOr; WLkez: $errorDesc = "\x45\x78\143\145\145\144\145\144\x20\146\151\154\x65\163\151\172\x65\x20\154\151\155\151\x74\40" . config("\x75\x70\x6c\x6f\x61\144\56\x73\x69\x7a\145") . "\56"; goto n90hR; upUG5: vIw70: goto WLkez; n90hR: KdcqF: goto swSzb; mZB8r: $originalName = $uploadInfo["\156\x61\x6d\x65"]; goto JfbbY; bWmhp: if (!($originalError != UPLOAD_ERR_OK)) { goto Bba5Z; } goto F3bv9; Lq845: Bba5Z: goto VDWUl; j3gyf: goto KdcqF; goto upUG5; wvBY_: H_sHU: goto yy29l; YaqOr: $saveName = $fileInfo->getSaveName(); goto dBopu; bo16t: uploadError("\x66\x61\x69\x6c\145\144\40\x74\157\x20\165\160\154\157\x61\x64\40\146\151\x6c\145\54\x20\x63\x61\x75\163\x65\x3a\x20" . $errorDesc); goto Lq845; n8Ls0: aH3rK: goto q8Sy0; GRhNs: $absoluteUrl = convertUploadSaveName2AbsoluteUrl($saveName); goto HAqr7; HuJlH: if (!($fileInfo == null)) { goto WThFU; } goto CU674; HAqr7: uploadSuccess("\163\165\143\x63\x65\163\163", ["\x6f\x72\151\147\151\x6e\x61\x6c\x5f\x6e\x61\155\x65" => $originalName, "\163\141\166\x65\137\x6e\141\x6d\x65" => $saveName, "\x75\162\154" => $url, "\162\x65\154\141\164\151\166\x65\137\x75\162\154" => $relativeUrl, "\141\142\x73\157\x6c\165\164\x65\x5f\165\162\154" => $absoluteUrl]); goto ipzwm; RnDln: if (!($file == null)) { goto H_sHU; } goto X6KYX; P92Sq: $originalTmpName = $uploadInfo["\164\155\160\137\x6e\x61\155\145"]; goto HBi1C; Z8e9u: $relativeUrl = convertUploadSaveName2RelativeUrl($saveName); goto GRhNs; X6KYX: uploadError("\x66\x61\151\154\145\x64\x20\164\157\40\x67\145\x74\x20\164\150\145\40\165\x70\x6c\157\141\144\40\x66\x69\154\x65"); goto wvBY_; VDWUl: $rules = array_merge(config("\165\160\154\157\141\144"), ["\x65\170\164" => "\x6a\160\147\54\x70\x6e\147\x2c\x67\151\146"]); goto OmeAX; CU674: uploadError("\345\244\261\350\264\245\40\55\x20" . $file->getError()); goto BWb1d; ipzwm: } public function uploadImport() { goto oaies; wvv4j: if (!($fileInfo == null)) { goto U3xcr; } goto DYHLs; g4gbn: PJyKi: goto pPfN8; Qixqu: goto zE1zO; goto vOdMv; oGnc8: uploadError("\x66\141\151\x6c\x65\x64\x20\164\x6f\40\x75\160\x6c\157\x61\x64\x20\x66\151\x6c\x65\x2c\40\x63\x61\165\x73\145\72\x20" . $errorDesc); goto g4gbn; n6lyy: $originalType = $uploadInfo["\164\x79\160\145"]; goto gg7S2; rAhGx: if ($originalError == UPLOAD_ERR_INI_SIZE || $originalError == UPLOAD_ERR_FORM_SIZE) { goto rreC2; } goto XqulX; NMp9J: uploadSuccess("\163\165\x63\x63\145\163\163", ["\x6f\162\151\147\x69\156\141\154\137\x6e\x61\x6d\x65" => $originalName, "\163\141\x76\x65\137\x6e\x61\x6d\x65" => $saveName, "\x75\162\154" => $url, "\162\145\x6c\141\x74\x69\x76\145\137\165\162\x6c" => $relativeUrl, "\141\142\x73\x6f\x6c\165\164\x65\x5f\165\x72\x6c" => $absoluteUrl]); goto akH1s; nU_Bq: $url = convertUploadSaveName2FullUrl($saveName); goto GzOGB; wWEM6: $originalTmpName = $uploadInfo["\164\155\160\x5f\x6e\x61\x6d\145"]; goto ufFPz; ufFPz: $originalError = $uploadInfo["\x65\162\162\157\x72"]; goto j6UPS; XqulX: $errorDesc = "\125\x6e\x6b\156\x6f\167\x6e\40\145\x72\162\157\162\x73\x2e"; goto Qixqu; XbS9V: mCZ8g: goto yJoMj; rlw4h: uploadError("\146\x61\151\x6c\145\x64\40\x74\157\40\147\145\164\x20\x74\x68\x65\x20\165\160\154\x6f\x61\144\x20\x66\x69\154\145"); goto v7FAm; gg7S2: $originalSize = $uploadInfo["\163\x69\x7a\145"]; goto wWEM6; v7FAm: oUG3J: goto BCysv; GzOGB: $relativeUrl = convertUploadSaveName2RelativeUrl($saveName); goto fnig0; vOdMv: rreC2: goto nnM15; BCysv: $uploadInfo = $file->getInfo(); goto iPVph; pPfN8: $rules = array_merge(config("\165\160\154\157\141\x64"), ["\x65\170\164" => "\x63\163\166\x2c\170\154\163\x2c\x78\x6c\163\x78"]); goto Skz3Q; bdwoD: goto eOV9w; goto XbS9V; yJoMj: $errorDesc = "\116\157\40\146\151\154\x65\40\163\145\156\164\x2e"; goto KHH9_; Skz3Q: $fileInfo = $file->validate($rules)->move(IMPORT_DIR); goto wvv4j; i76Sr: if ($originalError == UPLOAD_ERR_NO_FILE) { goto mCZ8g; } goto rAhGx; wgmES: $saveName = $fileInfo->getSaveName(); goto nU_Bq; fnig0: $absoluteUrl = convertUploadSaveName2AbsoluteUrl($saveName); goto NMp9J; j6UPS: if (!($originalError != UPLOAD_ERR_OK)) { goto PJyKi; } goto fVOQF; oaies: $file = request()->file("\165\x70\154\x6f\x61\144"); goto WJrKz; tCuNW: zE1zO: goto bdwoD; KHH9_: eOV9w: goto oGnc8; iPVph: $originalName = $uploadInfo["\x6e\x61\155\x65"]; goto n6lyy; WJrKz: if (!($file == null)) { goto oUG3J; } goto rlw4h; MA3O_: U3xcr: goto wgmES; fVOQF: $errorDesc = ''; goto i76Sr; nnM15: $errorDesc = "\x45\170\143\145\x65\144\145\144\x20\x66\151\x6c\145\x73\x69\x7a\145\40\154\x69\x6d\151\164\40" . config("\x75\x70\x6c\x6f\141\x64\x2e\163\x69\172\145") . "\x2e"; goto tCuNW; DYHLs: uploadError("\345\xa4\xb1\350\xb4\245\x20\x2d\40" . $file->getError()); goto MA3O_; akH1s: } public function uploadImageFromCKEditor($CKEditorFuncNum) { goto wsoZ9; Y7yX5: echo "\167\151\x6e\x64\x6f\x77\x2e\160\141\162\145\156\164\56\x43\x4b\105\104\111\124\x4f\122\56\x74\x6f\157\154\x73\56\x63\141\x6c\x6c\106\165\x6e\143\164\151\157\156\50" . $CKEditorFuncNum . "\x2c\47\47\54" . "\x27\x46\x69\154\145\x20\x73\x69\172\x65\40\155\165\x73\164\x20\x6e\x6f\x74\x20\142\145\40\x67\162\145\141\164\145\162\x20\164\150\141\156\40\x32\x4d\47\51\x3b"; goto c8IQX; J81UN: if (!($fileSize > 2 * 1024 * 1024)) { goto qjuPI; } goto jk0zT; V1DHB: if (!($fileMime != "\151\x6d\x61\x67\145\57\x70\152\160\x65\x67" && $fileMime != "\x69\155\x61\147\x65\x2f\152\160\145\x67" && $fileMime != "\151\155\x61\147\x65\57\x70\x6e\x67" && $fileMime != "\x69\155\141\x67\x65\x2f\x78\x2d\160\156\147" && $fileMime != "\x69\x6d\x61\x67\x65\x2f\x67\x69\146" && $fileMime != "\151\x6d\x61\x67\x65\x2f\x62\x6d\160")) { goto OMUGu; } goto SBP8U; GSDds: echo "\x3c\x73\143\x72\x69\x70\x74\40\x74\x79\160\145\75\x22\x74\145\170\164\57\x6a\141\x76\141\163\x63\162\151\160\x74\x22\76"; goto CyC5q; KgsQ9: $saveName = $fileInfo->getSaveName(); goto nMuvQ; bNwnL: $originalName = $uploadInfo["\x6e\x61\x6d\145"]; goto AVIsg; c8IQX: echo "\74\57\x73\x63\x72\x69\160\164\x3e"; goto x8Sfd; cdMPG: echo "\x77\x69\x6e\x64\x6f\167\56\x70\x61\x72\x65\x6e\164\x2e\103\x4b\x45\x44\111\124\117\x52\56\x74\x6f\x6f\154\x73\x2e\x63\141\x6c\154\106\x75\156\x63\x74\151\157\x6e\x28" . $CKEditorFuncNum . "\54\x27\47\x2c" . "\x27\x46\151\x6c\x65\40\x66\x6f\162\155\141\164\x20\x69\x73\40\x69\x6e\x63\x6f\x72\x72\x65\143\164\xef\274\210\155\165\x73\x74\40\x62\145\40\56\x6a\160\147\57\x2e\147\151\146\x2f\x2e\x62\155\x70\x2f\56\x70\156\x67\40\146\151\x6c\x65\357\274\211\47\x29\x3b"; goto cagVb; T0RDe: echo "\74\57\163\143\162\151\160\164\x3e"; goto lpfeX; Ogce3: echo "\x3c\57\163\143\x72\151\160\164\x3e"; goto xf2JA; EgzZ0: $fileName = $file->getFilename(); goto IO5Q6; SBP8U: echo "\x3c\163\x63\x72\151\x70\x74\40\164\171\x70\145\75\42\x74\x65\170\x74\57\x6a\x61\x76\x61\x73\143\162\x69\x70\x74\x22\x3e"; goto cdMPG; x8Sfd: exit; goto rPkbV; lpfeX: exit; goto Hmjm3; cagVb: echo "\x3c\x2f\x73\x63\162\151\160\164\76"; goto u0C81; wsoZ9: $file = request()->file("\165\160\154\157\x61\x64"); goto iI3yj; L3fGb: $uploadInfo = $file->getInfo(); goto bNwnL; dADN5: echo "\167\x69\x6e\x64\157\x77\x2e\160\141\162\x65\156\x74\56\x43\113\105\104\111\x54\117\x52\x2e\164\157\x6f\x6c\163\x2e\143\x61\154\x6c\106\165\x6e\143\x74\x69\x6f\x6e\50" . $CKEditorFuncNum . "\x2c\47\47\54" . "\x27\146\141\x69\x6c\145\x64\x20\164\157\x20\x72\145\x63\145\151\166\145\x20\164\x68\145\x20\146\151\154\x65\x27\x29\x3b"; goto eAEeZ; rPkbV: qjuPI: goto L3fGb; vgHbi: $fileSize = $file->getSize(); goto J81UN; iI3yj: if (!($file == null)) { goto DOVgD; } goto rMBNG; xf2JA: exit; goto OOJk3; yqIuu: exit; goto yPo0f; eAEeZ: echo "\74\57\163\x63\162\151\x70\164\x3e"; goto yqIuu; vrxC2: OMUGu: goto vgHbi; IO5Q6: $fileMime = $file->getMime(); goto V1DHB; jk0zT: echo "\74\163\x63\x72\x69\x70\164\40\x74\x79\x70\145\x3d\x22\x74\145\x78\164\57\152\141\166\x61\163\x63\x72\x69\x70\x74\x22\76"; goto Y7yX5; yPo0f: DOVgD: goto EgzZ0; rMBNG: echo "\x3c\x73\x63\162\151\160\x74\x20\x74\x79\160\x65\75\x22\164\x65\170\x74\x2f\152\x61\x76\141\163\143\162\151\x70\x74\42\x3e"; goto dADN5; b6vR3: echo "\x3c\x73\143\162\151\x70\x74\x20\x74\171\160\145\x3d\42\164\145\x78\x74\x2f\152\141\x76\x61\x73\143\162\x69\160\x74\x22\76"; goto VQQa0; nMuvQ: $url = convertUploadSaveName2AbsoluteUrl($saveName); goto b6vR3; xWSvo: if (!($fileInfo == null)) { goto Fq7t4; } goto GSDds; AVIsg: $fileInfo = $file->move(UPLOAD_DIR); goto xWSvo; Hmjm3: Fq7t4: goto KgsQ9; VQQa0: echo "\x77\151\156\x64\x6f\167\56\x70\x61\x72\x65\x6e\164\x2e\103\x4b\x45\104\111\x54\x4f\x52\x2e\164\x6f\157\x6c\x73\x2e\143\141\x6c\x6c\106\x75\x6e\143\x74\151\x6f\156\x28" . $CKEditorFuncNum . "\x2c\x27" . $url . "\x27\54\47\x27\x29\x3b"; goto Ogce3; CyC5q: echo "\x77\x69\156\x64\x6f\167\x2e\x70\141\x72\145\156\x74\x2e\103\x4b\105\x44\111\124\117\x52\56\164\157\x6f\154\163\56\x63\141\154\154\x46\165\x6e\x63\x74\151\157\156\x28" . $CKEditorFuncNum . "\x2c\x27\x27\x2c" . "\47\x66\141\x69\154\145\144\x20\164\157\40\162\x65\143\x65\x69\x76\x65\x20\x74\x68\145\40\146\x69\154\145\x27\51\73"; goto T0RDe; u0C81: exit; goto vrxC2; OOJk3: } public function uploadAttach($attachmentType, $externalId, $externalId2 = 0, $pid = 0) { goto nzMCq; rSFKm: uploadSuccess("\163\x75\x63\x63\145\x73\163", $uploaded, $html); goto TiphU; xIkxg: uploadError("\x66\141\151\x6c"); goto ctThc; TiNjx: $html .= "\xe4\xb8\212\344\274\xa0\xe6\x88\x90\345\212\237" . count($uploaded) . "\344\xb8\252\xef\xbc\214" . count($failed) . "\xe4\270\252\xe5\xa4\xb1\xe8\264\xa5\357\274\x9a\x3c\142\x72\76"; goto oJv71; Gqray: if (!empty($uploaded)) { goto vO_Yt; } goto xIkxg; gNngt: $html = ''; goto QYdgD; oJv71: $html .= join("\x3c\142\x72\x3e", $failed); goto PvO24; x9rr0: $uploaded = []; goto feGPM; PvO24: VbgsH: goto rSFKm; T22_n: if (!($multi_files == null)) { goto QMdT_; } goto c2mOt; QYdgD: if (!$failed) { goto VbgsH; } goto TiNjx; FwZem: gvk22: goto Gqray; c2mOt: uploadError("\146\141\x69\154\145\144\x20\x74\x6f\40\x67\145\164\x20\x74\150\145\40\x75\x70\154\157\x61\x64\x20\146\151\x6c\x65"); goto cdrfj; ctThc: vO_Yt: goto gNngt; HKern: $rules = config("\x75\160\x6c\x6f\x61\144"); goto x9rr0; feGPM: $failed = []; goto pVhaJ; cdrfj: QMdT_: goto HKern; pVhaJ: foreach ($multi_files as $idx => $file) { goto P7_X7; p3OHX: $fileName = $fileInfo->getFilename(); goto ocJhU; HRfU0: Log::notice("\x75\x70\x6c\x6f\141\144\101\164\x74\141\x63\x68\x2c\40\157\162\x67\x69\156\x61\154\x4e\141\x6d\x65\x3a\40{$originalName}\54\40\x73\141\x76\x65\x4e\141\x6d\x65\72\x20{$saveName}\54\x20\146\151\x6c\x65\x4e\141\155\145\x3a\40{$fileName}\x2c\40\146\151\154\x65\x4d\x69\x6e\145\72\x20{$fileMime}\54\x20\x66\x69\154\145\x73\x69\x7a\145\x3a\x20{$fileSize}"); goto Qb8LP; Eqlhu: $fileInfo = $file->validate($rules)->move(UPLOAD_DIR); goto b21z8; Qb8LP: $filePath = convertUploadSaveName2DiskFullPath($fileInfo->getSaveName()); goto AJWsy; i_EY1: $originalName = $uploadInfo["\156\x61\155\x65"]; goto Br8aL; gIsZq: $thumbnail = SITE_URL . "\x2f\163\x74\x61\164\151\x63\57\151\x6d\x67\57\x66\151\154\x65\56\x70\156\147"; goto obVbn; OYTDq: if ($fileMime == "\151\155\x61\147\145\x2f\x6a\x70\x65\147" || $fileMime == "\x69\x6d\x61\x67\145\57\x70\x6e\147" || $fileMime == "\x69\155\x61\x67\x65\57\147\x69\x66") { goto tmogV; } goto gIsZq; gDMXw: $fileSize = $fileInfo->getSize(); goto HRfU0; hg41X: nuRZA: goto vvrT4; ocJhU: $fileMime = $fileInfo->getMime(); goto gDMXw; qFwrT: $attachmentId = $uploadLogic->insertAttach($originalName, $saveName, $fileMime, $fileSize, '', $attachmentType, $externalId, $externalId2, $pid); goto cwZ9i; obVbn: goto WDkQI; goto nFALq; no13R: WDkQI: goto Kdbro; E4c96: $failed[] = $uploadInfo["\x6e\141\x6d\145"] . "\x3a\40" . $fileInfo->getError(); goto dpbgT; dpbgT: Bpo20: goto yS1Pa; cwZ9i: if (!$attachmentId) { goto nuRZA; } goto OYTDq; yS1Pa: $saveName = $fileInfo->getSaveName(); goto qt49D; nFALq: tmogV: goto bjduk; P7_X7: Log::notice("\165\160\154\157\141\x64\x41\164\164\x61\x63\150\x2c\40\x66\x69\x6c\x65\x20\151\156\146\157\x3a\40" . var_export($file->getInfo(), true)); goto wGa2h; vvrT4: eumcT: goto PBPhd; bjduk: $thumbnail = url("\125\160\154\157\141\x64\57\x74\x68\x75\x6d\142\156\x61\x69\154\x49\155\141\147\145", ["\141\164\164\141\x63\x68\x6d\145\x6e\164\111\144" => $attachmentId]); goto no13R; Br8aL: Log::notice("\165\x70\154\x6f\x61\144\x41\x74\x74\x61\143\150\54\x20\x6f\x72\151\x67\151\x6e\141\154\x20\x66\x69\154\145\40\156\x61\155\x65\x3a\40" . $originalName); goto Eqlhu; b21z8: if (!($fileInfo == null)) { goto Bpo20; } goto E4c96; Kdbro: $uploaded[] = ["\141\164\164\141\143\x68\x6d\x65\156\164\137\x69\144" => $attachmentId, "\156\x61\x6d\145" => $originalName, "\x73\x69\172\x65" => round($fileSize / 1024, 2), "\150\x72\145\x66\x5f\165\x72\x6c" => convertUploadSaveName2FullUrl($saveName), "\x74\x68\x75\x6d\x62\x6e\x61\x69\x6c\137\165\x72\x6c" => $thumbnail, "\x65\156\x74\145\162\145\x64" => date("\131\x2d\155\55\144\40\110\72\151"), "\144\157\x77\x6e\x6c\x6f\141\x64\137\x75\x72\x6c" => url("\125\x70\154\x6f\141\144\57\x64\x6f\x77\156\154\157\x61\x64\x41\x74\164\x61\x63\x68", ["\x61\164\164\141\x63\150\x6d\x65\x6e\164\x49\x64" => $attachmentId])]; goto hg41X; wGa2h: $uploadInfo = $file->getInfo(); goto i_EY1; AJWsy: $uploadLogic = UploadLogic::newObj(); goto qFwrT; qt49D: $extensionName = $fileInfo->getExtension(); goto p3OHX; PBPhd: } goto FwZem; nzMCq: $multi_files = request()->file("\165\x70\154\x6f\x61\144"); goto T22_n; TiphU: } public function uploadAttachZip($attachmentType, $externalId, $externalId2 = 0, $pid = 0) { goto ZPQKL; BtZ_k: u230S: goto X8Arr; c_V4D: $fileMime = $fileInfo->getMime(); goto ihwcx; dd47t: $this->scanAndSaveFiles($attachmentType, $externalId, $externalId2, $destinationPath, $copyFolder, $pid); goto HpgqK; n0ACr: $copyFolder = date("\131\x6d\x64"); goto S440j; YTRF4: Log::notice("\x75\160\x6c\157\x61\144\x41\x74\164\x61\x63\150\x5a\151\x70\54\40\157\162\151\x67\151\x6e\141\154\x20\146\x69\x6c\145\40\x6e\x61\155\145\72\x20" . $originalName); goto S9AP1; s_sak: $filePath = TEMP_DIR . DS . $fileInfo->getSaveName(); goto OaG25; ihwcx: $fileSize = $fileInfo->getSize(); goto ByMmd; qxcvF: uploadError("\xe8\xa7\xa3\345\216\213\346\x96\207\xe4\273\xb6\345\244\261\350\264\245"); goto Y_uhU; VOrVv: uploadError("\xe5\x88\x9b\xe5\xbb\272\346\x96\x87\344\xbb\xb6\345\xa4\271\345\xa4\xb1\350\xb4\245"); goto BtZ_k; S440j: $copyPath = UPLOAD_DIR . DS . $copyFolder; goto WazQN; NkIXu: lm3GO: goto fchV0; Y_uhU: gRI1J: goto n0ACr; OaG25: $destinationPath = substr($filePath, 0, strlen($filePath) - strlen("\x2e\x7a\151\x70")); goto KCdHG; IxEwT: if (!($fileInfo == null)) { goto Ny9HG; } goto yB7sw; hujlj: $fileName = $fileInfo->getFilename(); goto c_V4D; HpgqK: uploadSuccess("\x73\x75\143\x63\x65\163\163"); goto I0AmQ; xWAIJ: uploadError("\146\x61\x69\154\x65\x64\x20\164\157\40\x67\x65\164\x20\164\150\x65\x20\x75\x70\x6c\x6f\141\144\40\x66\x69\x6c\x65"); goto NkIXu; FuGbW: $cmdLine = sprintf("\45\x73\40\55\157\x20\x2d\x71\40\55\144\40\45\x73\40\x25\x73", $unzipExe, $destinationPath, $filePath); goto q05nm; YOzQs: $originalName = $uploadInfo["\x6e\141\x6d\x65"]; goto YTRF4; ZPQKL: $file = request()->file("\x75\160\x6c\157\141\144"); goto brPOl; ByMmd: Log::notice("\x75\x70\x6c\x6f\141\144\x41\164\x74\x61\x63\150\x5a\151\160\54\40\157\x72\x67\x69\156\141\154\116\141\x6d\x65\x3a\x20{$originalName}\x2c\40\x73\x61\x76\145\116\141\x6d\145\72\40{$saveName}\x2c\x20\x66\151\x6c\145\x4e\141\155\x65\72\40{$fileName}\54\40\x66\151\154\x65\x4d\151\x6e\145\72\40{$fileMime}\x2c\x20\146\151\x6c\x65\x73\x69\172\x65\72\x20{$fileSize}"); goto s_sak; IoF03: $unzipExe = getUnzipFullPath(); goto FuGbW; AHDGN: C5JVp: goto IoF03; b7g0b: $uploadInfo = $file->getInfo(); goto YOzQs; YdL1x: Log::notice("\x75\x70\x6c\157\x61\144\x41\164\164\141\143\150\132\x69\160\x2c\40\x66\151\154\x65\x20\x69\x6e\x66\157\x3a\x20" . var_export($file->getInfo(), true)); goto b7g0b; iURlq: $extensionName = $fileInfo->getExtension(); goto hujlj; z4fPx: uploadError("\345\210\233\345\273\xba\346\x96\x87\xe4\273\xb6\345\244\xb9\xe5\xa4\xb1\350\264\xa5"); goto AHDGN; X8Arr: oeap8: goto dd47t; krtrR: $saveName = $fileInfo->getSaveName(); goto iURlq; yB7sw: uploadError("\146\141\151\x6c\x20\x2d\40" . $fileInfo->getError()); goto h5jF8; fchV0: $rules = config("\x75\x70\x6c\157\141\x64"); goto YdL1x; KCdHG: if (mkdir($destinationPath)) { goto C5JVp; } goto z4fPx; q05nm: $result = system($cmdLine); goto oNoOQ; brPOl: if (!($file == null)) { goto lm3GO; } goto xWAIJ; oNoOQ: if (!($result === FALSE)) { goto gRI1J; } goto qxcvF; S9AP1: $fileInfo = $file->validate(array_merge($rules, ["\x65\170\x74" => "\x7a\x69\x70"]))->move(TEMP_DIR); goto IxEwT; HPEUY: if (mkdir($copyPath)) { goto u230S; } goto VOrVv; WazQN: if (file_exists($copyPath)) { goto oeap8; } goto HPEUY; h5jF8: Ny9HG: goto krtrR; I0AmQ: } protected function fetchAllFilesRecursively($path, &$files) { goto YThOZ; blOI3: foreach ($curFiles as $curFile) { goto RKEaf; uQB9_: if (!is_file($curFilePath)) { goto Nu2fX; } goto X5TuB; s6w2w: gzhOT: goto TT2au; RKEaf: if (!($curFile == "\x2e" || $curFile == "\56\x2e")) { goto ntTHJ; } goto QtfAp; J5ADD: ntTHJ: goto WyDr0; X5TuB: $files[] = $curFilePath; goto dIVD7; TT2au: $this->fetchAllFilesRecursively($curFilePath, $files); goto wuiE1; iKQ4c: if (is_dir($curFilePath)) { goto gzhOT; } goto uQB9_; QtfAp: goto QtRq1; goto J5ADD; wuiE1: TexkQ: goto CPpjq; WyDr0: $curFilePath = $path . DS . $curFile; goto iKQ4c; JyPGp: goto TexkQ; goto s6w2w; CPpjq: QtRq1: goto r5fcj; dIVD7: Nu2fX: goto JyPGp; r5fcj: } goto AmuAx; UmugK: Fp6vQ: goto blOI3; AmuAx: eZ93J: goto XfaAk; MIPkI: if ($curFiles) { goto Fp6vQ; } goto MYjsH; MYjsH: return; goto UmugK; XfaAk: return; goto L7UWB; YThOZ: $curFiles = scandir($path); goto MIPkI; L7UWB: } protected function scanAndSaveFiles($attachmentType, $externalId, $externalId2, $path, $save_dir, $pid = 0) { goto rA5xY; u0PIr: foreach ($files as $file) { goto pPkCE; YlafA: Tbjyc: goto bfJhZ; Vl0Io: $insert_id = Db::table("\141\x74\164\x61\143\150\x6d\145\156\164\163")->insertGetId(["\160\x69\x64" => $pid, "\157\162\151\x67\x69\156\x61\154\137\156\141\155\145" => $info["\x62\141\163\145\x6e\141\x6d\x65"], "\163\141\x76\x65\x5f\156\x61\155\145" => $save_name, "\163\x69\172\145" => $size, "\141\x74\x74\141\x63\150\155\x65\156\x74\x5f\164\x79\x70\x65" => $attachmentType, "\145\x78\x74\x65\x72\x6e\141\x6c\x5f\151\x64" => $externalId, "\145\170\164\x65\162\x6e\141\154\x5f\151\x64\62" => $externalId2, "\151\x73\144\x69\x72" => intval($isDir)]); goto yOa_L; k37IT: Log::notice("\146\x69\x6c\145\x3a\x20" . $file); goto l7BAw; cwcJj: goto L6HB1; goto SvbmE; Cm7ao: goto L6HB1; goto YlafA; PvJVD: $save_name .= "\x2e" . $info["\145\x78\x74\145\x6e\163\151\157\156"]; goto GUORH; yOa_L: if (!empty($insert_id)) { goto mO6GV; } goto vUA0i; j1cbD: if (!$isDir) { goto sHAI3; } goto bbqxe; ae4ep: goto kFxsW; goto GWJf8; ja8gT: $size = filesize($target); goto ae4ep; bfJhZ: $file = $path . DS . $file; goto mu3j3; bbqxe: $this->scanAndSaveFiles($attachmentType, $externalId, $externalId2, $file, $save_dir, $insert_id); goto Et58j; GUORH: chcAa: goto gW6hT; Et58j: sHAI3: goto JV9a6; hekte: if (!isset($info["\x65\x78\x74\145\x6e\x73\151\x6f\x6e"])) { goto chcAa; } goto PvJVD; yUQLW: $save_name = ''; goto ToVHt; gW6hT: $target = UPLOAD_DIR . DS . $save_name; goto Gl9o3; pPkCE: if (!($file == "\56" || $file == "\56\x2e")) { goto Tbjyc; } goto Cm7ao; zZ2Lo: kFxsW: goto Vl0Io; JV9a6: L6HB1: goto GDWuG; yOiwI: goto L6HB1; goto AkgZm; ToVHt: $size = 0; goto zZ2Lo; l7BAw: $info = pathinfo($file); goto U4L6P; Gl9o3: if (copy($file, $target)) { goto hxDPm; } goto yOiwI; S3K86: Log::notice("\x66\151\154\145\x20\x70\141\x74\x68\x69\x6e\146\x6f\x3a\x20" . var_export($info, true)); goto nhaef; vUA0i: goto L6HB1; goto lM3qo; GT1KE: $save_name = $save_dir . DS . generateUniqid(); goto hekte; AkgZm: hxDPm: goto ja8gT; SvbmE: BuQ39: goto S3K86; nhaef: if ($isDir) { goto p4QuG; } goto GT1KE; mu3j3: $isDir = is_dir($file); goto k37IT; lM3qo: mO6GV: goto j1cbD; U4L6P: if (!empty($info)) { goto BuQ39; } goto cwcJj; GWJf8: p4QuG: goto yUQLW; GDWuG: } goto qIfLC; f453P: AWl7B: goto u0PIr; wgrbR: return; goto f453P; qIfLC: sEZRC: goto FqY_H; rA5xY: $files = scandir($path); goto x0S9z; x0S9z: if (!empty($files)) { goto AWl7B; } goto wgrbR; FqY_H: } public function attaches($attachmentType, $externalId, $externalId2 = 0, $callback = '', $uiStyle = self::ATTACHES_UI_BIG_STYLE, $prompt = '', $fit = 0, $replace = 0) { goto Q1Exx; xEa40: $uploadLogic = UploadLogic::newObj(); goto uql7z; GjL7V: CzvO0: goto jXUHw; D7fzn: $this->assign("\x75\156\151\x71\x69\144", generateUniqid()); goto Y_clj; n6Hbp: goto bsiRP; goto eXrZX; j3Km2: $urlHrefs = ["\141\164\164\141\x63\x68\145\163" => url("\x55\x70\x6c\157\x61\144\x2f\141\x74\x74\x61\143\x68\x65\x73", ["\141\x74\x74\x61\x63\x68\x6d\x65\156\x74\x54\171\160\145" => $attachmentType, "\x65\x78\x74\145\x72\x6e\141\x6c\x49\x64" => $externalId, "\x65\170\x74\x65\x72\x6e\x61\154\x49\144\x32" => $externalId2]), "\x75\x70\154\x6f\141\144\101\164\164\141\x63\x68" => url("\125\160\154\157\141\x64\57\x75\x70\x6c\x6f\x61\x64\101\x74\x74\141\x63\150", ["\141\164\x74\141\143\x68\155\x65\156\164\x54\171\x70\145" => $attachmentType, "\x65\x78\x74\145\x72\156\141\x6c\111\x64" => $externalId, "\x65\x78\164\x65\x72\156\x61\x6c\x49\x64\x32" => $externalId2, "\x72\145\160\154\x61\x63\145" => $replace]), "\144\145\x6c\x65\x74\145\x41\x74\164\x61\143\x68\145\x73" => url("\x55\x70\154\157\x61\x64\57\x64\x65\x6c\x65\x74\x65\x41\x74\164\x61\x63\150\x65\x73"), "\144\x65\x6c\x65\164\x65\x41\164\164\x61\143\x68" => url("\x55\x70\154\x6f\x61\x64\57\x64\x65\154\145\x74\x65\x41\x74\164\141\143\150")]; goto ToHi6; DTUjw: $attaches[$i]["\x74\x68\x75\155\x62\156\141\151\154\137\165\x72\x6c"] = url("\x55\160\154\x6f\141\x64\57\164\150\165\x6d\x62\156\x61\151\154\111\x6d\x61\147\145", ["\x61\164\164\x61\143\150\155\x65\156\x74\111\144" => $attaches[$i]["\x61\x74\164\141\143\150\155\x65\x6e\x74\x5f\151\144"]]); goto hrKwr; jXUHw: $bindValues = ["\x61\164\x74\141\x63\150\x6d\x65\156\164\x54\171\x70\145" => $attachmentType, "\145\170\164\x65\162\x6e\x61\x6c\x49\x64" => $externalId, "\x61\164\x74\x61\143\150\x65\x73" => $attaches, "\162\145\160\154\x61\143\145" => $replace, "\x63\141\x6c\x6c\142\x61\143\x6b" => $callback]; goto vawJc; vawJc: $this->assign("\x62\x69\156\144\126\141\154\x75\x65\163", $bindValues); goto D7fzn; D3Njn: $count = count($attaches); goto xyndG; bS0Gy: $i = 0; goto fWiJY; qsGLF: $i++; goto LqZDx; h8TCs: oXxEv: goto xEa40; mTo1d: $attaches[$i]["\x64\157\x77\156\x6c\x6f\141\x64\137\x75\162\154"] = url("\125\x70\154\x6f\x61\144\x2f\x64\157\167\156\x6c\x6f\141\144\101\x74\164\141\x63\x68", ["\141\x74\x74\141\143\x68\x6d\145\x6e\x74\111\x64" => $attaches[$i]["\x61\x74\x74\x61\143\x68\x6d\x65\x6e\x74\x5f\x69\144"]]); goto dvFVj; NhfPS: $attaches[$i]["\164\150\x75\155\142\x6e\141\151\154\x5f\165\162\154"] = SITE_URL . "\x2f\163\x74\x61\x74\x69\x63\57\151\155\x67\57\x66\x69\154\145\56\x70\x6e\x67"; goto hO8NW; xyndG: IHfSn: goto oPVQ8; dvFVj: D_Yka: goto qsGLF; hrKwr: xmJWT: goto d6hcU; v1WT3: bsiRP: goto uvv39; v2yn2: goto LT1ob; goto uk_CS; Q1Exx: if (!request()->isGet()) { goto oXxEv; } goto j3Km2; jd9GB: $attaches = $uploadLogic->getAttaches($attachmentType, $externalId, $externalId2); goto dadOO; dadOO: $i = 0; goto D3Njn; eNnhk: return json($attaches); goto bGmN1; SLVkS: $attaches[$i]["\x74\150\x75\x6d\x62\156\141\151\154\137\x75\162\154"] = SITE_URL . "\57\163\164\141\164\151\143\x2f\151\155\147\57\x66\151\154\145\x2e\160\156\x67"; goto v2yn2; SZjSk: $this->assign("\x66\x69\164", $fit); goto pyK7J; AK1Go: if ($mimeType == "\x69\155\141\147\145\57\x6a\160\145\147" || $mimeType == "\x69\x6d\141\147\x65\57\x70\x6e\147" || $mimeType == "\x69\x6d\141\x67\145\57\x67\151\x66") { goto xrupD; } goto NhfPS; dmSAZ: $uploadLogic = UploadLogic::newObj(); goto jd9GB; oPVQ8: if (!($i < $count)) { goto CzvO0; } goto DtIC4; eXrZX: fIp1L: goto eNnhk; KwM67: rcQgl: goto DCdE4; HioR3: $mimeType = $attaches[$i]["\x6d\151\x6d\x65\x5f\164\171\x70\145"]; goto AK1Go; xp44A: LT1ob: goto mTo1d; uvv39: if (!($i < $count)) { goto fIp1L; } goto HioR3; fWiJY: $count = count($attaches); goto v1WT3; d6hcU: $attaches[$i]["\x64\157\167\x6e\154\x6f\x61\x64\137\x75\x72\x6c"] = url("\125\160\x6c\157\141\x64\57\144\x6f\x77\x6e\x6c\x6f\141\x64\101\x74\x74\141\x63\150", ["\141\x74\164\141\143\150\155\145\x6e\164\111\x64" => $attaches[$i]["\x61\x74\x74\141\143\150\x6d\x65\156\x74\x5f\x69\x64"]]); goto uG4nD; uk_CS: OeasJ: goto efSkU; O_ajr: if ($mimeType == "\151\x6d\x61\x67\x65\57\x6a\x70\145\x67" || $mimeType == "\151\x6d\x61\147\145\x2f\x70\x6e\147" || $mimeType == "\151\x6d\x61\147\x65\x2f\x67\x69\x66") { goto OeasJ; } goto SLVkS; LqZDx: goto IHfSn; goto GjL7V; ToHi6: $this->assign("\165\162\154\x48\x72\x65\x66\x73", $urlHrefs); goto dmSAZ; hO8NW: goto xmJWT; goto exUUv; pyK7J: switch ($uiStyle) { case self::ATTACHES_UI_BIG_STYLE: return $this->fetch(); goto Iy3xB; case self::ATTACHES_UI_LIGHT_STYLE: return $this->fetch("\141\x74\x74\x61\x63\x68\145\163\x5f\154\x69\147\x68\164"); goto Iy3xB; case self::ATTACHES_UI_TABLE_STYLE: return $this->fetch("\x61\x74\164\141\x63\x68\145\x73\x5f\164\x61\142\x6c\145"); goto Iy3xB; case self::ATTACHES_UI_DATAGRID_STYLE: return $this->fetch("\141\x74\x74\x61\x63\150\x65\x73\x5f\x64\141\x74\141\147\162\151\144"); goto Iy3xB; case self::ATTACHES_UI_LINK_STYLE: return $this->fetch("\141\x74\x74\141\143\150\145\x73\x5f\x6c\151\156\x6b"); goto Iy3xB; default: return $this->fetch(); } goto KwM67; uG4nD: AlUzK: goto fhU8i; fhU8i: $i++; goto n6Hbp; Y_clj: $this->assign("\x70\x72\157\155\160\x74", $prompt); goto SZjSk; efSkU: $attaches[$i]["\164\150\165\155\x62\156\141\151\x6c\137\165\x72\154"] = url("\125\x70\154\x6f\141\x64\57\x74\x68\165\x6d\142\156\x61\151\154\111\155\x61\x67\145", ["\x61\x74\164\x61\x63\150\x6d\x65\x6e\164\x49\x64" => $attaches[$i]["\x61\x74\164\x61\143\x68\x6d\x65\156\x74\137\151\x64"]]); goto xp44A; uql7z: $attaches = $uploadLogic->getAttaches($attachmentType, $externalId, $externalId2); goto bS0Gy; exUUv: xrupD: goto DTUjw; DtIC4: $mimeType = $attaches[$i]["\x6d\151\x6d\145\x5f\164\x79\160\145"]; goto O_ajr; DCdE4: Iy3xB: goto h8TCs; bGmN1: } public function viewAttaches($attachmentType, $externalId, $externalId2 = 0, $uiStyle = self::ATTACHES_UI_BIG_STYLE, $fit = 0) { goto J8v0s; Uj1QQ: if ($mimeType == "\x69\x6d\x61\147\x65\57\152\x70\x65\x67" || $mimeType == "\x69\x6d\141\147\x65\57\160\x6e\x67" || $mimeType == "\151\155\141\147\145\x2f\x67\151\146") { goto rCI0G; } goto ApmIA; tkf_R: $attaches[$i]["\164\150\165\x6d\142\156\x61\x69\154\137\x75\162\x6c"] = SITE_URL . "\57\163\x74\141\164\151\x63\57\151\x6d\147\x2f\146\151\154\145\x2e\160\x6e\147"; goto zh6Zx; hiuiu: goto o3TO9; goto LtR4j; sEXgC: PCs7t: goto yGh1T; uosDi: $i++; goto YkvIq; Vwp5H: $i = 0; goto aH8lw; QHLg6: $mimeType = $attaches[$i]["\155\x69\x6d\x65\x5f\x74\171\160\145"]; goto Uj1QQ; J8v0s: if (!request()->isGet()) { goto jJ_rS; } goto UZKjD; m5sHB: $attaches[$i]["\x74\x68\165\155\142\156\x61\x69\154\137\x75\x72\154"] = url("\x55\160\154\x6f\141\x64\x2f\x74\x68\x75\155\142\156\x61\x69\154\111\155\141\147\145", ["\x61\x74\164\x61\143\x68\155\x65\156\x74\x49\144" => $attaches[$i]["\x61\164\x74\141\143\150\x6d\x65\x6e\x74\x5f\x69\x64"]]); goto eABRc; fsEtB: kFLRO: goto uosDi; KSyjk: jJ_rS: goto NpFui; yGh1T: $bindValues = ["\141\164\x74\x61\x63\x68\x6d\x65\156\164\x54\171\x70\x65" => $attachmentType, "\x65\x78\164\145\162\156\141\154\x49\x64" => $externalId, "\145\x78\164\x65\x72\156\141\x6c\x49\x64\62" => $externalId2, "\x61\x74\164\141\143\150\x65\x73" => $attaches]; goto g05oB; UZKjD: $urlHrefs = ["\141\x74\164\x61\x63\150\145\163" => url("\x55\160\x6c\157\141\144\x2f\141\164\164\x61\x63\150\145\x73", ["\141\x74\x74\141\143\x68\x6d\145\x6e\x74\124\171\x70\145" => $attachmentType, "\x65\x78\x74\x65\162\x6e\141\154\x49\x64" => $externalId, "\x65\170\164\x65\162\x6e\x61\154\x49\144\62" => $externalId2])]; goto YOLEO; eJSs2: $count = count($attaches); goto cr5Cx; YOLEO: $this->assign("\x75\162\x6c\x48\x72\145\x66\163", $urlHrefs); goto m3kJy; YkvIq: goto I6m4H; goto W_sYZ; E_FTn: DkKGu: goto ldbpL; SO0mP: cjQpt: goto MKUSF; o0EMw: $i = 0; goto eJSs2; VUxF2: $this->assign("\146\x69\164", $fit); goto WdWsO; WdWsO: switch ($uiStyle) { case self::ATTACHES_UI_BIG_STYLE: return $this->fetch(); goto TAsNK; case self::ATTACHES_UI_LIGHT_STYLE: return $this->fetch("\x76\x69\145\x77\x5f\x61\164\164\141\x63\x68\x65\163\x5f\x6c\151\x67\x68\164"); goto TAsNK; case self::ATTACHES_UI_TABLE_STYLE: return $this->fetch("\x76\x69\x65\x77\137\x61\x74\164\x61\143\150\145\163\137\164\x61\x62\x6c\145"); goto TAsNK; case self::ATTACHES_UI_DATAGRID_STYLE: return $this->fetch("\x76\x69\x65\167\x5f\x61\164\164\141\x63\150\x65\x73\x5f\144\141\164\x61\147\162\x69\144"); goto TAsNK; case self::ATTACHES_UI_LINK_STYLE: return $this->fetch("\166\x69\x65\167\x5f\141\164\x74\x61\143\150\x65\163\137\154\151\x6e\x6b"); goto TAsNK; default: return $this->fetch(); } goto Rcq9i; LtR4j: rCI0G: goto m5sHB; vYh2O: goto FVi4q; goto sEXgC; NpFui: $uploadLogic = UploadLogic::newObj(); goto DYuFb; g05oB: $this->assign("\142\x69\156\x64\126\141\x6c\165\145\163", $bindValues); goto cQkQ8; MKUSF: $attaches[$i]["\164\150\x75\x6d\142\x6e\141\x69\x6c\x5f\165\162\x6c"] = url("\x55\x70\x6c\157\x61\144\57\164\x68\165\155\x62\x6e\x61\151\154\111\155\141\147\x65", ["\x61\x74\164\x61\143\150\x6d\145\156\x74\111\144" => $attaches[$i]["\141\164\164\141\x63\150\155\x65\156\x74\137\x69\x64"]]); goto RjaZA; FODAQ: $attaches = $uploadLogic->getAttaches($attachmentType, $externalId, $externalId2); goto Vwp5H; Q4S_7: if (!($i < $count)) { goto PCs7t; } goto BhioY; RjaZA: Auu2J: goto CBekO; BhioY: $mimeType = $attaches[$i]["\155\151\x6d\145\x5f\x74\x79\160\145"]; goto uHTo8; K6e74: return json($attaches); goto BKTJD; ldbpL: $i++; goto vYh2O; t8KJj: FVi4q: goto Q4S_7; zh6Zx: goto Auu2J; goto SO0mP; aH8lw: $count = count($attaches); goto t8KJj; m3kJy: $uploadLogic = UploadLogic::newObj(); goto FODAQ; VeIM4: TAsNK: goto KSyjk; APwHV: $attaches[$i]["\144\x6f\x77\156\154\157\x61\x64\x5f\165\162\154"] = url("\125\x70\154\157\x61\144\57\144\157\167\156\154\157\141\x64\x41\x74\164\141\143\x68", ["\141\164\164\x61\143\x68\x6d\x65\156\164\111\x64" => $attaches[$i]["\141\x74\164\141\143\x68\x6d\x65\156\164\x5f\151\144"]]); goto fsEtB; CBekO: $attaches[$i]["\144\x6f\167\156\x6c\x6f\141\x64\137\x75\x72\x6c"] = url("\x55\x70\154\x6f\141\x64\x2f\144\x6f\167\156\x6c\x6f\x61\144\x41\x74\x74\x61\143\x68", ["\141\x74\164\141\x63\x68\155\145\x6e\x74\x49\144" => $attaches[$i]["\141\164\164\x61\143\x68\155\145\x6e\164\x5f\151\x64"]]); goto E_FTn; cQkQ8: $this->assign("\x75\x6e\x69\161\x69\x64", generateUniqid()); goto VUxF2; DYuFb: $attaches = $uploadLogic->getAttaches($attachmentType, $externalId, $externalId2); goto o0EMw; uHTo8: if ($mimeType == "\151\x6d\x61\147\145\x2f\x6a\x70\x65\x67" || $mimeType == "\151\155\141\147\145\57\160\156\147" || $mimeType == "\x69\155\x61\147\145\57\x67\x69\146") { goto cjQpt; } goto tkf_R; Rcq9i: kRDFT: goto VeIM4; ApmIA: $attaches[$i]["\x74\x68\165\155\x62\x6e\141\x69\x6c\x5f\165\x72\x6c"] = SITE_URL . "\57\163\164\x61\x74\x69\x63\57\x69\155\147\57\x66\x69\154\x65\x2e\x70\x6e\x67"; goto hiuiu; POMyx: if (!($i < $count)) { goto umhcU; } goto QHLg6; cr5Cx: I6m4H: goto POMyx; eABRc: o3TO9: goto APwHV; W_sYZ: umhcU: goto K6e74; BKTJD: } public function previewAttach($attachmentId, $newTab = 0) { goto cIc2n; drcI1: S2tZG: goto YnWBn; urL9N: $ext = $ext[count($ext) - 1]; goto DL1H_; Jq2qi: NpOof: goto CI16w; pQY0A: $filesize = filesize(iconv("\125\124\x46\55\70", "\x67\x62\62\x33\61\62", $filePath)); goto LoT9r; nKXmO: j9ANd: goto Jq2qi; X3IIM: $filePath = convertUploadSaveName2DiskFullPath($attach["\x73\141\166\x65\x5f\156\141\x6d\x65"]); goto idPaN; qtiU8: gtK92: goto xAs42; CI16w: if (!$newTab) { goto Yp2bX; } goto VrO0a; Bt8WS: G2Nfd: goto xV3Th; ZAPIR: $attach["\x70\x72\x65\166\151\x65\x77\x5f\x74\171\160\145"] = false; goto vAd4U; idPaN: if (!file_exists($filePath)) { goto qqISu; } goto pQY0A; lRYN0: qqISu: goto xlCzF; ILBxH: return $this->fetch(); goto dT0CQ; DF0Ac: if ($attach) { goto G2Nfd; } goto T_FVU; xV3Th: $ext = explode("\56", $attach["\x73\141\x76\x65\137\x6e\x61\155\145"]); goto urL9N; zvz8k: CGYYp: goto EROXf; VrO0a: if ($attach["\x70\162\145\x76\151\x65\167\x5f\164\x79\x70\145"]) { goto gtK92; } goto YiM0_; xAs42: $this->redirect($preview_url); goto olPAm; clm4T: $attach["\145\x72\x72\157\x72\137\x6d\x73\147"] = "\143\141\x6e\40\x6e\x6f\x74\40\x66\x69\156\x64\40\164\150\x65\40\146\151\154\145"; goto nKXmO; cIc2n: $attach = Db::table("\x61\164\164\141\x63\150\155\x65\156\x74\x73")->where("\141\x74\164\x61\x63\x68\x6d\x65\x6e\x74\137\x69\144", $attachmentId)->field("\141\x74\164\141\143\150\155\x65\156\164\x5f\x69\x64\x2c\163\141\166\x65\x5f\x6e\141\155\x65\54\163\151\172\145")->find(); goto DF0Ac; luibs: if (!(false != $attach["\x70\162\145\x76\151\145\167\137\x74\x79\x70\x65"])) { goto NpOof; } goto X3IIM; CVhjO: switch (strtolower($ext)) { case "\144\x6f\x63": case "\x64\157\x63\170": case "\x78\154\163": case "\x78\x6c\x73\170": case "\160\x70\164": case "\x70\160\x74\170": goto xAXc0; xAXc0: $attach["\160\x72\145\x76\x69\145\x77\137\164\x79\x70\145"] = "\x6f\146\146\x69\x63\145"; goto z_y6s; djwYp: goto HOxyN; goto OKE8o; z_y6s: $preview_url = "\150\x74\x74\x70\163\72\x2f\x2f\166\x69\x65\167\56\x6f\x66\146\151\x63\x65\x61\160\x70\x73\56\x6c\x69\166\x65\x2e\x63\x6f\x6d\57\x6f\x70\57\166\151\145\x77\56\141\x73\x70\x78\x3f\x73\162\x63\75" . $url; goto djwYp; OKE8o: case "\x70\x64\146": $attach["\x70\162\145\166\151\x65\x77\137\x74\x79\160\145"] = "\160\x64\x66"; goto HOxyN; case "\x6a\160\147": case "\160\156\x67": case "\x67\x69\x66": case "\x6a\x70\x65\147": $attach["\x70\x72\145\x76\151\x65\167\137\164\x79\160\x65"] = "\151\x6d\x61\x67\x65"; goto HOxyN; default: $attach["\160\162\x65\166\x69\145\x77\137\164\171\160\x65"] = false; $attach["\x65\x72\x72\157\162\137\x6d\163\x67"] = "\143\x61\156\x27\x74\40\x73\x75\x70\x70\157\x72\x74\x20\x74\x68\145\40\x66\x69\x6c\145\40\164\x79\160\x65\40\x74\157\40\160\162\145\x76\151\x65\167\54\40\x70\154\145\141\x73\145\x20\x64\x6f\x77\156\154\157\141\144\40\x69\164"; } goto drcI1; vAd4U: $attach["\145\162\x72\x6f\162\137\155\x73\x67"] = "\x74\150\x65\40\146\151\154\145\40\x73\x69\x7a\145\40\151\163\40\164\157\x6f\x20\x6c\x61\x72\x67\145\x2c\40\x6d\x61\170\x20\x61\154\154\157\167\x65\144\40\x66\151\x6c\x65\40\163\151\172\145\x3a\40" . config("\x75\160\x6c\157\141\x64\x2e\141\154\154\x6f\167\137\x70\x72\x65\x76\x69\145\x77\x5f\x6d\x61\170\137\x73\x69\x7a\x65"); goto zvz8k; LoT9r: if (!($filesize > config("\165\x70\x6c\157\x61\x64\x2e\141\x6c\154\x6f\167\137\x70\162\x65\166\x69\145\167\137\x6d\x61\x78\137\x73\151\172\145"))) { goto CGYYp; } goto ZAPIR; dmeF6: $preview_url = $url; goto CVhjO; YiM0_: return $attach["\145\x72\x72\157\162\137\155\x73\x67"]; goto qtiU8; klLhl: $this->assign($attach); goto ILBxH; KrGEc: $attach["\x70\162\145\x76\151\145\x77\137\x75\162\x6c"] = $preview_url; goto klLhl; olPAm: Yp2bX: goto KrGEc; T_FVU: return $this->fetch("\143\x6f\155\155\157\156\57\145\x72\x72\x6f\162"); goto Bt8WS; EROXf: goto j9ANd; goto lRYN0; xlCzF: $attach["\x70\162\145\x76\x69\145\x77\137\x74\x79\x70\145"] = false; goto clm4T; YnWBn: HOxyN: goto luibs; DL1H_: $url = convertUploadSaveName2FullUrl($attach["\x73\141\166\145\137\x6e\141\155\x65"]); goto dmeF6; dT0CQ: } public function deleteAttach($attachmentId) { goto Y0AQy; Y0AQy: $uploadLogic = UploadLogic::newObj(); goto CZgnA; Vhjvn: return ajaxSuccess("\xe6\223\215\344\xbd\234\346\210\220\345\x8a\237"); goto PjMlC; CZgnA: $uploadLogic->deleteAttach($attachmentId); goto Vhjvn; PjMlC: } public function deleteAttaches($attachmentIds) { goto Mf6oF; rvxTB: return ajaxSuccess("\xe6\223\x8d\xe4\275\234\346\x88\220\345\x8a\237"); goto M3tED; rRmaE: foreach ($attachmentIds as $attachmentId) { $uploadLogic->deleteAttach($attachmentId); PwUZM: } goto Mhvzu; Mf6oF: $uploadLogic = UploadLogic::newObj(); goto rRmaE; Mhvzu: Q8TQR: goto rvxTB; M3tED: } public function downloadAttach($attachmentId) { goto CCj9f; CCj9f: $attach = Db::table("\141\x74\164\141\x63\150\x6d\x65\156\164\163")->where("\141\164\x74\141\x63\x68\155\x65\156\164\x5f\x69\x64", $attachmentId)->field("\x61\x74\x74\141\143\150\155\x65\156\x74\137\x69\144\54\x6f\162\151\x67\151\x6e\x61\154\137\156\x61\155\x65\x2c\163\x61\x76\x65\137\156\141\155\145\54\155\x69\x6d\x65\x5f\164\171\x70\x65\x2c\151\163\x64\x69\x72")->find(); goto NKhWi; Kd2Oa: header("\x43\x6f\156\164\145\156\164\x2d\124\171\160\x65\72\40\x61\160\160\x6c\x69\143\141\164\x69\157\156\57\146\x6f\x72\143\x65\x2d\x64\x6f\167\156\154\157\141\x64"); goto Zy6ZL; aYBn8: $originalPath = convertUploadSaveName2DiskFullPath($attach["\x73\x61\166\x65\x5f\x6e\x61\x6d\145"]); goto wb_9n; LSIbk: return $this->fetch("\x63\x6f\155\x6d\157\156\57\x65\x72\x72\157\162"); goto mo7g8; owAjx: header("\x50\162\141\x67\155\x61\72\x20\156\157\x2d\x63\x61\143\x68\145"); goto Kd2Oa; xFRyN: ex3Ni: goto aYBn8; wb_9n: if (file_exists($originalPath)) { goto zP9jS; } goto rDR5S; MFxf5: header("\103\x6f\156\164\145\x6e\x74\x2d\x44\151\x73\x70\157\163\x69\164\151\157\156\72\40\x61\164\x74\x61\x63\x68\155\x65\156\x74\x3b\40\146\151\154\145\156\x61\x6d\145\x3d" . $attach["\157\162\x69\x67\151\x6e\141\x6c\137\x6e\141\x6d\x65"]); goto xuR6M; VlqQd: header("\x43\141\143\x68\x65\55\x43\x6f\156\164\162\157\154\x3a\x20\x6e\x6f\55\163\x74\157\162\x65\54\x20\x6e\x6f\55\x63\x61\143\150\145\x2c\x20\x6d\165\x73\164\x2d\162\145\x76\141\154\151\144\141\164\145"); goto gcVem; l0m4b: exit; goto KYNCu; C5L6F: zP9jS: goto X9zQJ; tjv3b: exit("\xe6\x9a\x82\xe4\270\215\346\x94\257\xe6\x8c\201\344\270\213\xe8\275\xbd\xe6\226\207\344\273\xb6\345\xa4\xb9"); goto xFRyN; gcVem: header("\103\141\x63\150\x65\55\x43\157\x6e\x74\162\x6f\x6c\x3a\40\160\157\x73\164\55\x63\150\145\x63\153\x3d\x30\54\40\160\162\145\55\143\x68\145\143\x6b\75\x30", false); goto owAjx; rDR5S: return $this->fetch("\143\157\x6d\x6d\157\156\x2f\145\162\x72\157\x72"); goto C5L6F; Zy6ZL: header("\x43\157\156\x74\145\x6e\164\55\x4c\145\156\147\x74\x68\72\x20" . filesize($originalPath)); goto MFxf5; xuR6M: readfile($originalPath); goto l0m4b; eaAab: if (!$attach["\151\x73\144\151\162"]) { goto ex3Ni; } goto tjv3b; X9zQJ: header("\x45\170\160\151\162\x65\x73\x3a\40\x4d\157\156\x2c\40\62\x36\40\112\165\154\x20\61\71\71\67\x20\x30\x35\x3a\60\60\72\60\60\x20\107\115\124"); goto VlqQd; mo7g8: Xu_lB: goto eaAab; NKhWi: if ($attach) { goto Xu_lB; } goto LSIbk; KYNCu: } public function thumbnailImageAttach($attachmentId) { goto XTSAG; I0kLn: header("\105\x78\160\x69\162\x65\x73\x3a\40\115\x6f\x6e\x2c\40\62\66\x20\112\165\x6c\40\61\71\71\67\40\x30\x35\x3a\x30\60\72\x30\x30\x20\x47\115\x54"); goto V0Bnd; XTSAG: $imagePath = STATIC_DIR . DS . "\151\x6d\x67\x2f\x6e\x6f\x5f\x69\x6d\141\x67\145\x2e\x6a\160\x67"; goto UnLxz; OYIs8: $originalPath = convertUploadSaveName2DiskFullPath($attach["\163\x61\166\145\137\156\141\x6d\x65"]); goto UgD48; UnLxz: $imageType = "\151\155\x61\147\x65\57\152\x70\145\147"; goto ipTdI; ipTdI: $attach = Db::table("\141\164\x74\141\143\150\155\x65\156\164\163")->where("\x61\164\x74\141\143\x68\x6d\145\x6e\x74\x5f\151\144", $attachmentId)->field("\141\x74\x74\141\143\150\x6d\x65\156\164\x5f\151\x64\x2c\163\141\x76\145\137\x6e\141\x6d\x65\54\155\151\x6d\x65\137\x74\171\x70\x65")->find(); goto Dr5s1; lMj8Y: MnDRw: goto bpLf7; gCQCx: vsRUD: goto wiFwC; vHXxp: pD80U: goto wZDHT; bpLf7: wIA2O: goto I0kLn; dKGyP: exit; goto xl_H1; hU3q5: header("\x43\x6f\x6e\164\145\156\164\55\x54\171\x70\x65\72\40" . $imageType); goto WSkHq; wiFwC: goto MnDRw; goto vHXxp; UgD48: if (!file_exists($originalPath)) { goto vsRUD; } goto XaVLC; oyqyS: $imageType = $attach["\155\x69\x6d\x65\x5f\x74\x79\x70\145"]; goto lMj8Y; V0Bnd: header("\103\141\143\150\x65\x2d\103\x6f\156\164\162\157\154\x3a\x20\x6e\157\x2d\163\164\157\x72\145\54\x20\156\157\x2d\x63\x61\x63\x68\x65\x2c\x20\155\165\163\164\55\162\x65\x76\141\x6c\151\x64\x61\164\145"); goto cndts; Kv6h6: $thumbnailPath = convertUploadSaveNameThumbnail2DiskFullPath($attach["\x73\x61\x76\x65\137\156\141\x6d\x65"]); goto QUk9N; Dr5s1: if (!$attach) { goto wIA2O; } goto Kv6h6; QUk9N: if (file_exists($thumbnailPath)) { goto pD80U; } goto OYIs8; cndts: header("\x43\x61\x63\x68\145\55\103\x6f\x6e\164\162\157\154\72\40\x70\157\163\164\x2d\x63\x68\145\143\x6b\x3d\60\54\x20\x70\162\x65\55\x63\x68\x65\x63\x6b\x3d\x30", false); goto yOVt5; QblQt: echo file_get_contents($imagePath); goto dKGyP; wZDHT: $imagePath = $thumbnailPath; goto oyqyS; XaVLC: try { goto QPTHv; mNUI2: $imageType = $attach["\x6d\x69\x6d\x65\137\x74\x79\160\145"]; goto TZdWR; F7wZQ: $image->save($thumbnailPath); goto WDwAR; QPTHv: $image = Image::open($originalPath); goto LTn17; WDwAR: $imagePath = $thumbnailPath; goto mNUI2; LTn17: $image->thumb(100, 100); goto F7wZQ; TZdWR: } catch (Exception $e) { Log::error("\145\x78\x63\145\160\x74\151\157\156\40\x6f\x63\143\x75\162\x20\x77\150\145\x6e\40\143\162\x65\x61\x74\145\x20\164\150\x75\x6d\142\156\141\151\x6c\40\x69\155\x61\x67\145\x20\146\x6f\x72\40" . $originalPath); } goto gCQCx; WSkHq: header("\x43\157\156\x74\145\x6e\164\x2d\114\145\x6e\x67\164\150\72\x20" . filesize($imagePath)); goto QblQt; yOVt5: header("\x50\162\141\147\x6d\x61\72\40\x6e\157\55\143\x61\x63\x68\145"); goto hU3q5; xl_H1: } public function setAttachesType($attachmentId, $entity_type, $target_type = 0) { goto xnwc3; Piz1I: if (is_array($attachmentId)) { goto zroEV; } goto csile; WoWRe: if (!empty($target_type)) { goto o9x3T; } goto S03ON; vPlb4: O7ABE: goto WoWRe; BE6o5: return ajaxSuccess("\344\277\256\xe6\224\xb9\346\x88\220\345\212\237"); goto oxIve; atldW: zroEV: goto EOlXv; xnwc3: if (!$this->request->isGet()) { goto O7ABE; } goto Kur_w; S03ON: return ajaxError("\xe8\257\267\351\200\211\346\x8b\251\347\x9b\xae\346\xa0\x87\345\210\206\xe7\261\xbb"); goto cdty4; cdty4: o9x3T: goto Piz1I; EOlXv: $where["\x61\164\164\141\143\x68\x6d\145\x6e\164\137\x69\x64"] = count($attachmentId) > 1 ? ["\151\x6e", $attachmentId] : $attachmentId[0]; goto Odd_5; Kur_w: $types = array_filter(UploadLogic::$attachTypeDefs, function ($v) use($entity_type) { return $entity_type == $v["\145\x6e\164\151\x74\x79\137\x74\x79\x70\x65"]; }); goto CWhh1; Odd_5: Attachments::update(["\141\x74\x74\141\143\x68\x6d\x65\156\164\137\x74\171\160\145" => $target_type, "\160\151\144" => 0], $where); goto BE6o5; csile: $attachmentId = explode("\x2c", $attachmentId); goto atldW; CWhh1: return $this->fetch('', ["\164\x79\x70\x65\x73" => $types]); goto vPlb4; oxIve: } public function changeDir($attachment_id, $pid) { Attachments::update(["\x70\151\144" => $pid], ["\141\164\164\141\143\150\x6d\145\x6e\164\x5f\151\x64" => $attachment_id]); return ajaxSuccess("\xe7\247\273\345\x8a\xa8\xe6\210\220\xe5\212\237"); } public function addDir($external_id, $attachment_type, $dir_name, $external_id2 = 0, $pid = 0) { Db::table("\141\x74\164\141\143\150\x6d\x65\156\x74\x73")->insertGetId(["\x6f\x72\x69\147\151\156\141\x6c\x5f\x6e\141\x6d\x65" => $dir_name, "\x61\164\x74\141\143\x68\155\x65\156\164\137\164\171\160\145" => $attachment_type, "\145\170\x74\x65\162\x6e\141\154\137\x69\144" => $external_id, "\145\170\164\145\x72\156\141\x6c\x5f\151\144\x32" => $external_id2, "\x70\151\x64" => $pid, "\151\x73\x64\x69\162" => 1]); return ajaxSuccess("\346\x93\215\xe4\xbd\x9c\xe6\x88\x90\xe5\212\237"); } public function uploadCampaignAttach($campaignId) { goto P7uWi; s3H1C: Log::notice("\x75\160\154\157\141\144\x43\x61\155\x70\141\151\147\x6e\x41\164\164\141\x63\150\54\40\157\162\x67\x69\x6e\141\x6c\x4e\141\x6d\145\x3a\x20{$originalName}\x2c\x20\x73\x61\x76\145\116\x61\x6d\x65\72\40{$saveName}\x2c\x20\x66\x69\154\x65\x4e\x61\155\145\x3a\x20{$fileName}\54\x20\146\x69\154\145\115\x69\x6e\x65\x3a\x20{$fileMime}\54\x20\x66\151\154\x65\x73\151\x7a\x65\x3a\40{$fileSize}"); goto VJZUQ; vG19r: uploadSuccess("\163\165\x63\143\145\163\163", ["\x63\x61\155\x70\x61\x69\147\156\137\141\164\164\x61\x63\150\137\151\x64" => $campaignAttachId, "\x6e\x61\155\x65" => $originalName, "\163\x69\x7a\x65" => number_format($fileSize), "\150\x72\x65\x66\x5f\165\162\154" => convertUploadSaveName2FullUrl($saveName), "\164\x68\165\155\x62\156\141\151\x6c\137\x75\x72\x6c" => $thumbnail, "\144\157\167\156\x6c\x6f\141\144\x5f\x75\x72\154" => url("\x55\160\x6c\x6f\x61\144\57\144\x6f\x77\x6e\154\x6f\141\144\103\141\x6d\x70\141\151\147\x6e\101\164\x74\x61\x63\x68", ["\x63\141\155\160\141\x69\x67\x6e\x41\x74\x74\141\x63\x68\x49\x64" => $campaignAttachId])]); goto BFCd0; bWo5U: $campaignsLogic = CampaignsLogic::I(); goto DQRnz; rGRew: D3Sji: goto Qo7bG; DQRnz: $campaignAttachId = $campaignsLogic->insertAttach($campaignId, $originalName, $saveName, $fileMime, $fileSize, ''); goto N1gWk; Wy1vN: $fileSize = $fileInfo->getSize(); goto s3H1C; WgC32: $extensionName = $fileInfo->getExtension(); goto l6F0W; rVM5p: $saveName = $fileInfo->getSaveName(); goto WgC32; SWkxc: uploadError("\146\141\151\154\x20\55\40" . $fileInfo->getError()); goto e6Fn5; CE87K: q8X0w: goto vG19r; VJZUQ: $filePath = convertUploadSaveName2DiskFullPath($fileInfo->getSaveName()); goto bWo5U; P7uWi: $file = request()->file("\x75\160\x6c\157\141\144"); goto euOYA; BFCd0: LDKRW: goto Stag6; N1gWk: if ($campaignAttachId) { goto D3Sji; } goto pw9hJ; bhx8j: $fileInfo = $file->validate($rules)->move(UPLOAD_DIR); goto NxXnU; BPdhJ: tfonv: goto xQEKC; NxXnU: if (!($fileInfo == null)) { goto sI4pG; } goto SWkxc; QTshz: hKzRj: goto J3kvB; OizJ6: goto LDKRW; goto rGRew; gkOhd: $originalName = $uploadInfo["\156\x61\155\x65"]; goto U113v; wWteI: uploadError("\x66\141\x69\154\x65\x64\x20\x74\157\40\x67\x65\164\40\x74\x68\x65\40\165\x70\x6c\157\141\144\x20\x66\151\154\x65"); goto QTshz; pw9hJ: uploadError("\146\141\151\154"); goto OizJ6; e6Fn5: sI4pG: goto rVM5p; euOYA: if (!($file == null)) { goto hKzRj; } goto wWteI; l6F0W: $fileName = $fileInfo->getFilename(); goto Nd5kq; Nd5kq: $fileMime = $fileInfo->getMime(); goto Wy1vN; aikt_: $uploadInfo = $file->getInfo(); goto gkOhd; Qo7bG: if ($fileMime == "\x69\155\141\147\145\57\152\160\145\x67" || $fileMime == "\151\x6d\141\147\x65\x2f\160\x6e\x67" || $fileMime == "\x69\x6d\x61\147\x65\57\147\151\x66") { goto tfonv; } goto MKLnI; J3kvB: Log::notice("\x75\x70\154\x6f\x61\x64\x43\141\155\160\x61\151\x67\x6e\101\x74\164\141\143\150\x2c\x20\146\151\x6c\145\40\151\x6e\146\157\x3a\x20" . var_export($file->getInfo(), true)); goto aikt_; xQEKC: $thumbnail = url("\x55\x70\x6c\157\x61\144\x2f\x74\150\165\155\142\156\141\151\x6c\111\155\x61\147\x65", ["\143\x61\155\160\141\x69\x67\156\x41\164\164\141\x63\x68\111\144" => $campaignAttachId]); goto CE87K; MKLnI: $thumbnail = SITE_URL . "\x2f\163\x74\x61\x74\151\x63\x2f\151\x6d\147\x2f\146\151\154\145\56\x70\x6e\147"; goto z0iqB; LKBDg: $rules = array_merge(config("\x75\x70\154\157\x61\144"), []); goto bhx8j; z0iqB: goto q8X0w; goto BPdhJ; U113v: Log::notice("\x75\x70\154\157\x61\x64\x43\141\155\160\141\x69\147\x6e\x41\x74\164\141\x63\150\54\40\157\162\151\x67\151\156\141\154\x20\146\x69\x6c\x65\40\156\141\x6d\145\72\x20" . $originalName); goto LKBDg; Stag6: } public function previewCampaignAttach($campaignId, $campaignAttachId) { goto OHfXg; AM33i: VDmag: goto HEVXM; yAIee: if (!($filesize > 5242880)) { goto QFScf; } goto QbA7I; NW0Js: $attach = Db::table("\x63\x61\x6d\160\141\x69\147\156\x5f\141\x74\164\141\x63\150\x6d\145\156\x74\x73")->where("\x63\141\x6d\160\x61\151\x67\156\137\x61\x74\x74\141\143\x68\x5f\x69\144", $campaignAttachId)->field("\x63\141\x6d\x70\141\151\147\156\137\x61\x74\x74\x61\x63\150\137\151\x64\54\x73\141\166\145\137\x6e\141\x6d\x65\54\163\x69\x7a\x65")->find(); goto wZe3L; XHS0J: kJQjB: goto Y4kOY; wZe3L: if ($attach) { goto VDmag; } goto roW1R; JscSc: $ext = $ext[count($ext) - 1]; goto vrxCB; Yza1L: QFScf: goto GPXHU; roW1R: return $this->fetch("\143\157\x6d\155\157\156\57\x65\x72\x72\x6f\162"); goto AM33i; RQ7fD: $this->assign($attach); goto Z9c0Y; Lp8A7: $attach["\x65\x72\x72\157\x72\x5f\155\x73\x67"] = "\x74\x68\x65\x20\x66\x69\x6c\x65\40\x73\151\172\x65\x20\x69\163\40\x74\157\157\x20\154\141\162\147\145"; goto Yza1L; M5G8V: T0Tx1: goto A_03C; Z9c0Y: return $this->fetch(); goto M5G8V; Z8EMr: Log::notice("\x70\162\145\x76\151\x65\x77\103\x61\155\x70\x61\x69\147\x6e\101\x74\164\x61\x63\x68\54\x20\x75\162\154\72\x20" . $url); goto C8Xyk; veOkN: if (!(false != $attach["\160\162\x65\x76\151\x65\x77\x5f\164\x79\x70\x65"])) { goto Pfurp; } goto jHaM1; vrxCB: $url = convertUploadSaveName2FullUrl($attach["\163\x61\166\x65\137\x6e\141\155\145"]); goto Z8EMr; yKQaR: $filesize = filesize(iconv("\125\124\106\x2d\70", "\147\142\x32\63\x31\x32", $filePath)); goto yAIee; Y4kOY: i28JT: goto veOkN; qRP1Z: $attach["\x75\x72\154"] = $url; goto RQ7fD; C8Xyk: switch (strtolower($ext)) { case "\x64\157\143": case "\x64\x6f\143\x78": case "\170\x6c\163": case "\x78\x6c\x73\x78": case "\160\160\164": case "\160\160\164\170": goto qCamD; qCamD: $attach["\160\x72\x65\x76\x69\x65\x77\x5f\164\x79\160\145"] = "\x6f\146\x66\x69\x63\x65"; goto TxolE; TxolE: $attach["\160\x72\x65\166\x69\x65\167\x5f\163\x72\143"] = "\150\164\164\160\163\x3a\57\x2f\166\151\145\167\x2e\x6f\146\x66\x69\x63\145\141\160\x70\163\x2e\x6c\x69\x76\145\56\143\157\155\57\x6f\x70\x2f\166\151\x65\x77\x2e\x61\x73\160\x78\77\163\x72\x63\75" . $url; goto xPLvz; xPLvz: goto i28JT; goto ArPhV; ArPhV: case "\160\x64\x66": $attach["\x70\162\x65\166\151\x65\x77\x5f\164\x79\160\145"] = "\x70\144\146"; goto i28JT; case "\152\160\x67": case "\x70\156\x67": case "\147\x69\146": case "\x6a\x70\x65\x67": $attach["\160\x72\145\166\151\145\x77\x5f\x74\171\160\145"] = "\x69\155\141\x67\145"; goto i28JT; default: $attach["\x70\162\x65\166\151\145\x77\x5f\x74\171\x70\x65"] = false; $attach["\145\x72\x72\x6f\x72\x5f\x6d\163\147"] = "\x63\141\x6e\47\164\40\x73\165\160\160\157\162\x74\40\164\x68\x65\40\x66\151\154\x65\40\x74\x79\x70\x65\40\x74\x6f\40\x70\162\145\x76\151\x65\x77\54\x20\x70\x6c\x65\x61\163\145\40\144\157\x77\156\x6c\157\x61\x64\x20\151\164"; } goto XHS0J; jHaM1: $filePath = convertUploadSaveName2DiskFullPath($attach["\163\141\166\x65\x5f\x6e\x61\x6d\x65"]); goto yKQaR; OHfXg: if (!request()->isGet()) { goto T0Tx1; } goto NW0Js; QbA7I: $attach["\x70\x72\x65\x76\151\x65\167\x5f\164\x79\x70\x65"] = false; goto Lp8A7; HEVXM: $ext = explode("\56", $attach["\x73\x61\x76\x65\137\156\x61\155\x65"]); goto JscSc; GPXHU: Pfurp: goto qRP1Z; A_03C: } public function deleteCampaignAttach($campaignAttachId) { Db::table("\143\141\x6d\x70\x61\x69\x67\156\x5f\141\x74\164\x61\143\x68\x6d\x65\156\164\x73")->where("\143\141\155\160\141\151\x67\x6e\137\x61\164\x74\x61\143\x68\137\151\144", $campaignAttachId)->delete(); return ajaxSuccess("\163\x75\x63\x63\145\163\x73"); } public function downloadCampaignAttach($campaignAttachId) { goto pLlza; F3gug: readfile($originalPath); goto gaMdw; ZSkEJ: return $this->fetch("\143\x6f\155\x6d\157\156\x2f\x65\x72\162\157\162"); goto WL0NV; spPT5: if ($attach) { goto KkSuS; } goto A2OLj; pLlza: $attach = Db::table("\143\141\x6d\x70\141\x69\147\x6e\137\x61\164\164\141\x63\x68\155\145\x6e\x74\x73")->where("\x63\141\x6d\160\x61\151\147\x6e\137\x61\x74\164\x61\x63\150\137\151\144", $campaignAttachId)->field("\x63\141\x6d\160\x61\x69\147\156\x5f\x61\164\164\x61\x63\150\x5f\151\144\x2c\157\x72\151\147\151\x6e\141\x6c\137\156\x61\x6d\145\x2c\x73\x61\166\x65\137\x6e\141\155\145\54\155\x69\155\x65\x5f\x74\x79\160\x65")->find(); goto spPT5; gaMdw: exit; goto zREte; A2OLj: return $this->fetch("\x63\x6f\x6d\155\157\x6e\x2f\145\162\x72\x6f\162"); goto n3h89; L3EUV: header("\x43\x6f\x6e\x74\145\x6e\164\x2d\x4c\x65\156\147\164\x68\x3a\40" . filesize($originalPath)); goto s3Lap; BjJVn: header("\x43\x61\143\x68\145\55\103\157\156\x74\162\157\154\72\x20\160\157\x73\164\x2d\143\150\x65\143\x6b\75\60\x2c\x20\x70\x72\x65\55\143\150\145\x63\x6b\75\60", false); goto f_90j; f_90j: header("\x50\x72\141\147\x6d\x61\72\40\x6e\157\x2d\x63\x61\143\150\x65"); goto zMV_6; LH01F: header("\x45\x78\x70\151\162\x65\x73\x3a\x20\115\x6f\156\54\40\62\x36\x20\112\x75\154\40\61\x39\x39\x37\x20\60\x35\72\60\x30\x3a\60\60\40\x47\x4d\x54"); goto x5JqF; zMV_6: header("\x43\157\x6e\x74\145\x6e\x74\x2d\x54\x79\160\x65\72\x20\141\160\x70\154\x69\x63\x61\x74\x69\x6f\156\57\x66\157\162\143\145\x2d\144\157\167\156\x6c\x6f\x61\x64"); goto L3EUV; n3h89: KkSuS: goto sQ4cE; s3Lap: header("\103\157\x6e\164\x65\x6e\164\55\x44\151\163\x70\x6f\x73\151\x74\151\157\x6e\72\x20\x61\164\x74\x61\x63\150\155\x65\156\164\x3b\40\x66\x69\x6c\x65\156\x61\155\145\x3d" . $attach["\x6f\162\x69\147\151\x6e\141\x6c\x5f\156\x61\x6d\x65"]); goto F3gug; KiHu0: if (file_exists($originalPath)) { goto jhG9k; } goto ZSkEJ; WL0NV: jhG9k: goto LH01F; sQ4cE: $originalPath = convertUploadSaveName2DiskFullPath($attach["\x73\141\166\x65\x5f\156\141\155\145"]); goto KiHu0; x5JqF: header("\103\x61\x63\x68\145\x2d\103\157\156\x74\162\157\x6c\x3a\40\x6e\x6f\x2d\x73\164\157\162\x65\54\x20\x6e\x6f\x2d\143\x61\143\x68\145\x2c\40\x6d\165\163\164\55\x72\145\x76\x61\x6c\151\144\x61\164\145"); goto BjJVn; zREte: } public function thumbnailImage($campaignAttachId) { goto Vc1UW; jSSYX: header("\x43\157\156\164\x65\156\164\x2d\124\171\x70\x65\x3a\x20" . $imageType); goto KSLBT; HmIvu: $attach = Db::table("\x63\x61\x6d\160\x61\151\x67\x6e\x5f\141\164\x74\141\x63\150\155\x65\x6e\x74\163")->where("\143\x61\x6d\160\x61\151\x67\156\x5f\141\x74\164\141\143\x68\x5f\151\144", $campaignAttachId)->field("\143\141\x6d\160\141\151\147\156\x5f\x61\x74\x74\x61\x63\150\x5f\x69\x64\54\x73\141\166\145\137\156\x61\x6d\x65\54\x6d\151\155\145\137\x74\x79\x70\145")->find(); goto Nx1Ff; ULht2: header("\103\x61\143\150\145\55\103\157\156\164\x72\x6f\x6c\72\40\160\157\x73\x74\55\143\x68\145\x63\153\75\60\54\40\x70\162\145\55\x63\150\145\143\x6b\x3d\60", false); goto ErOqd; cTZDq: header("\x45\170\160\151\162\145\163\72\x20\x4d\x6f\156\54\x20\x32\x36\40\x4a\x75\x6c\40\x31\x39\71\x37\40\x30\x35\x3a\60\60\72\60\x30\40\x47\115\124"); goto t3LIH; ScCpU: mgSwe: goto cTZDq; Vc1UW: $imagePath = STATIC_DIR . DS . "\x69\155\147\57\x6e\x6f\137\x69\x6d\141\147\x65\56\152\x70\x67"; goto NVOVG; pIz2Y: $imageType = $attach["\x6d\x69\155\145\x5f\164\x79\160\x65"]; goto IGakC; Lxs8y: exit; goto aCbCL; Nx1Ff: if (!$attach) { goto mgSwe; } goto DcXOY; au9nH: goto n6SYI; goto rR2F4; IGakC: n6SYI: goto ScCpU; NVOVG: $imageType = "\151\x6d\x61\x67\x65\x2f\x6a\x70\145\147"; goto HmIvu; rasvk: echo file_get_contents($imagePath); goto Lxs8y; JXQPT: if (file_exists($thumbnailPath)) { goto owzNe; } goto sFZC4; sFZC4: $originalPath = convertUploadSaveName2DiskFullPath($attach["\163\x61\166\x65\x5f\156\x61\x6d\x65"]); goto QX425; ErOqd: header("\x50\x72\x61\147\x6d\141\72\x20\156\x6f\55\143\x61\x63\x68\145"); goto jSSYX; t3LIH: header("\103\141\x63\150\145\55\103\157\x6e\x74\162\157\x6c\x3a\40\156\x6f\x2d\163\164\x6f\162\x65\x2c\40\x6e\x6f\55\143\x61\143\150\145\x2c\40\x6d\165\x73\x74\55\x72\x65\x76\x61\x6c\x69\x64\x61\x74\145"); goto ULht2; tcKnL: GBcH1: goto au9nH; KSLBT: header("\x43\157\156\x74\145\156\164\x2d\x4c\145\x6e\147\x74\150\x3a\x20" . filesize($imagePath)); goto rasvk; QX425: if (!file_exists($originalPath)) { goto GBcH1; } goto YMzJp; YMzJp: try { goto nDNK7; nDNK7: $image = Image::open($originalPath); goto OjTC0; CMeSE: $imageType = $attach["\155\x69\x6d\x65\137\164\x79\160\145"]; goto Xpamz; OjTC0: $image->thumb(100, 100); goto io4Fa; io4Fa: $image->save($thumbnailPath); goto pa3Uj; pa3Uj: $imagePath = $thumbnailPath; goto CMeSE; Xpamz: } catch (Exception $e) { Log::error("\145\x78\x63\x65\160\x74\x69\x6f\156\x20\x6f\143\x63\x75\x72\40\x77\150\x65\156\40\x63\162\145\x61\x74\145\40\164\x68\x75\x6d\142\x6e\141\x69\154\x20\x69\155\x61\147\x65\x20\146\x6f\x72\40" . $originalPath); } goto tcKnL; baoTE: $imagePath = $thumbnailPath; goto pIz2Y; rR2F4: owzNe: goto baoTE; DcXOY: $thumbnailPath = convertUploadSaveNameThumbnail2DiskFullPath($attach["\x73\141\x76\145\x5f\156\141\x6d\145"]); goto JXQPT; aCbCL: } }
