<?php
 namespace app\index\controller; use app\Defs; use app\index\Defs as IndexDefs; use think\Controller; use think\Request; use think\Url; use think\Log; use think\Debug; use think\Db; use app\index\logic\CampaignLists as CampaignListsLogic; use app\index\logic\Campaigns as CampaignsLogic; use app\index\logic\Lists as ListsLogic; class CampaignLists extends Common { public function campaignLists($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto VFebI; ad00X: $this->assign("\165\162\x6c\110\162\x65\x66\163", $urlHrefs); goto Ff6Dh; VFebI: if (!request()->isGet()) { goto Sd0pM; } goto vjqm4; oOkdx: Sd0pM: goto I9yp2; Ff6Dh: return $this->fetch(); goto oOkdx; vjqm4: $urlHrefs = ["\143\x61\155\160\141\151\147\156\x44\162\141\146\x74\114\151\163\x74\x73" => url("\x63\x61\x6d\160\141\151\147\156\x44\x72\141\x66\x74\x4c\x69\x73\x74\x73"), "\x63\x61\155\160\141\x69\147\x6e\x41\x63\x74\151\x76\x65\114\151\163\164\x73" => url("\x63\141\x6d\x70\141\x69\147\156\x41\x63\x74\x69\166\x65\x4c\x69\163\164\x73"), "\x63\x61\x6d\160\x61\151\147\156\x53\145\x6e\x74\x4c\151\x73\164\x73" => url("\143\x61\155\160\x61\x69\147\x6e\x53\145\x6e\x74\x4c\151\x73\164\x73"), "\x63\x61\x6d\160\141\x69\147\x6e\114\151\163\x74\163\x43\162\x65\141\164\x65" => url("\103\x61\x6d\x70\141\x69\x67\x6e\163\x2f\x73\x65\x6e\144\103\x61\155\x70\x61\151\147\x6e\x43\x72\145\x61\164\145"), "\x63\x61\x6d\x70\x61\x69\147\156\x4c\x69\x73\x74\163\x45\x64\151\x74" => url("\103\x61\x6d\160\141\151\x67\156\x73\57\x73\x65\156\144\x43\141\x6d\x70\141\151\x67\x6e\105\144\151\164"), "\x63\141\155\160\x61\x69\x67\156\110\171\160\x65\162\154\151\x6e\153\x53\164\x61\x74\151\163" => url("\x48\171\x70\x65\162\154\x69\x6e\x6b\163\57\143\x61\155\x70\141\151\147\156\x48\x79\x70\x65\x72\x6c\x69\x6e\x6b\123\x74\141\x74\151\163"), "\x63\x61\x6d\160\141\x69\147\156\104\x65\164\141\x69\154" => url("\143\141\x6d\x70\x61\x69\x67\x6e\x44\145\x74\141\x69\x6c")]; goto ad00X; I9yp2: } public function campaignDraftLists($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto yjJtd; GPa96: return json($campaignListsLogic->loadDraftCampaigns($search, $page, $rows, $sort, $order)); goto wM0kW; M0RxW: $this->assign("\165\162\x6c\x48\162\145\x66\163", $urlHrefs); goto V0jA6; i5qW2: $campaignListsLogic = CampaignListsLogic::I(); goto GPa96; V0jA6: return $this->fetch(); goto dCIIt; yjJtd: if (!request()->isGet()) { goto wMC5D; } goto YL8z_; YL8z_: $urlHrefs = ["\x63\141\155\160\x61\151\147\156\x4c\x69\x73\x74\163" => url("\143\141\155\x70\141\x69\147\156\x44\x72\141\x66\164\x4c\151\x73\x74\x73"), "\x63\141\x6d\160\141\x69\x67\156\x4c\151\x73\164\163\104\x65\164\141\x69\154" => url("\x63\x61\x6d\x70\141\151\x67\156\104\x72\x61\x66\x74\x4c\151\x73\x74\163\x44\145\x74\x61\x69\154"), "\163\x65\156\144\x43\x61\155\160\x61\x69\147\156\104\x65\x6c\145\164\145" => url("\x43\x61\x6d\x70\x61\151\147\156\163\57\163\145\156\144\x43\141\x6d\x70\141\151\x67\x6e\104\x65\154\x65\164\x65"), "\x73\145\156\x64\x43\x61\x6d\160\141\151\147\x6e\105\144\151\x74" => url("\x43\x61\x6d\160\x61\151\x67\x6e\163\x2f\x73\145\156\x64\x43\141\155\x70\141\x69\147\x6e\105\x64\151\164")]; goto M0RxW; dCIIt: wMC5D: goto i5qW2; wM0kW: } public function campaignActiveLists($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto DnUKN; MBMwD: $campaignListsLogic = CampaignListsLogic::newObj(); goto mkFg7; DnUKN: if (!request()->isGet()) { goto XV7Yz; } goto riqRK; GHtD1: $this->assign("\x75\162\154\110\162\145\146\x73", $urlHrefs); goto aCsJw; GWcr2: XV7Yz: goto MBMwD; riqRK: $urlHrefs = ["\143\141\155\x70\141\x69\147\156\x4c\x69\163\x74\x73" => url("\x63\x61\x6d\x70\x61\151\x67\x6e\101\143\164\151\x76\145\x4c\151\x73\164\x73"), "\x63\x61\x6d\160\x61\x69\x67\x6e\114\151\163\x74\x73\x44\x65\164\141\151\154" => url("\x63\x61\155\160\141\x69\x67\x6e\x4c\151\x73\164\x73\104\x65\164\x61\151\x6c"), "\x63\x61\155\x70\141\151\147\x6e\x52\x65\x71\165\145\x75\145" => url("\143\x61\155\x70\x61\x69\147\156\122\145\161\165\x65\x75\145"), "\x63\x61\x6d\x70\141\x69\147\156\x53\165\163\160\145\x6e\144" => url("\x63\141\x6d\160\x61\151\x67\x6e\x53\x75\x73\x70\x65\x6e\144"), "\x63\141\155\160\141\151\147\156\x4d\x61\x72\153\123\x65\156\164" => url("\143\x61\x6d\160\x61\151\x67\x6e\115\141\x72\x6b\x53\x65\x6e\x74"), "\x73\145\x6e\x64\x43\x61\x6d\160\141\151\x67\x6e\x45\144\151\x74" => url("\103\141\155\160\x61\151\x67\x6e\x73\57\163\x65\x6e\x64\x43\141\155\x70\x61\x69\147\156\x45\144\151\164")]; goto GHtD1; mkFg7: return json($campaignListsLogic->loadActiveCampaigns($search, $page, $rows, $sort, $order)); goto n8rvZ; aCsJw: return $this->fetch(); goto GWcr2; n8rvZ: } public function campaignSentLists($search = array(), $page = 1, $rows = 20, $sort = "\x63\x61\155\x70\x61\x69\147\x6e\137\x69\x64", $order = "\144\145\163\x63") { goto cfpQe; OSHwa: return json($campaignListsLogic->loadSentCampaigns($search, $page, $rows, $sort, $order)); goto FrdOn; fEGYX: Kvxi0: goto J_Pl7; J_Pl7: $campaignListsLogic = CampaignListsLogic::I(); goto OSHwa; cfpQe: if (!request()->isGet()) { goto Kvxi0; } goto Ch26b; Ch26b: $urlHrefs = ["\143\141\x6d\x70\141\x69\147\x6e\x4c\x69\163\x74\163" => url("\x63\141\155\x70\141\151\x67\156\x53\x65\156\164\x4c\x69\x73\164\163"), "\x63\x61\x6d\160\x61\151\147\x6e\x4c\151\x73\164\x73\104\145\164\141\151\x6c" => url("\143\x61\155\x70\141\151\x67\156\x4c\151\x73\x74\x73\x44\x65\164\141\151\154"), "\143\x61\x6d\160\141\x69\x67\x6e\122\x65\161\165\145\165\145" => url("\x63\141\155\160\x61\151\147\156\122\145\x71\x75\x65\x75\145")]; goto VCVWc; VCVWc: $this->assign("\165\x72\154\x48\162\x65\x66\163", $urlHrefs); goto x0kCx; x0kCx: return $this->fetch(); goto fEGYX; FrdOn: } public function campaignDetail($campaignId) { goto tC2sc; j69aQ: $mailbox = $mailboxConfig["\x74\151\164\154\x65"]; goto No4gR; eL2oj: $listsLogic = ListsLogic::I(); goto bwQr6; V8LFl: $this->assign("\x63\x61\x6d\x70\141\x69\147\156\101\164\164\x61\x63\x68\x65\163", $campaignAttaches); goto eL2oj; BNbJE: $attaches = $campaignsLogic->getAttaches($campaignId); goto AHUer; bwQr6: $targetLists = $listsLogic->loadDataGridDatasByCampaign($campaignId); goto M5NNw; VLck4: return $this->fetch("\x63\157\155\155\157\x6e\57\145\x72\x72\157\162"); goto WQT25; tC2sc: $campaignsLogic = CampaignsLogic::I(); goto pyVSN; No4gR: drdyK: goto Hgre4; Tj1Ch: $campaignData["\155\x61\151\x6c\142\x6f\x78"] = $mailbox; goto jaytm; n3Dom: goto dihMV; goto UTbDT; WQT25: zcNJz: goto ApPnz; YfzTV: if (!($i < $count)) { goto p15ee; } goto Ig1gZ; TGty8: $i++; goto n3Dom; lUjqa: Lv7w6: goto GdvRv; a8rjf: $i = 0; goto FqdGa; qOU3I: dihMV: goto YfzTV; dNZhA: $mailboxConfig = $mailboxesLogic->getMailboxInfos($mailboxId); goto iUFWj; hlz6Z: foreach ($targetLists as $targetList) { goto EGUgx; CmwMY: KZrlN: goto MLL11; Sp5wN: $subscriberCount = $targetList["\163\x75\x62\x73\x63\x72\151\x62\145\162\137\x63\x6f\165\156\x74"]; goto OzFt6; EGUgx: $name = $targetList["\x6e\141\x6d\145"]; goto Sp5wN; OzFt6: $campaignLists[] = ["\156\141\x6d\145" => $name, "\x73\x75\142\163\143\162\151\142\145\162\x5f\x63\x6f\165\156\x74" => $subscriberCount]; goto CmwMY; MLL11: } goto lUjqa; ApPnz: $mailboxId = $campaignData["\155\141\x69\154\x62\157\170\x5f\151\144"]; goto sWZmJ; iUFWj: if (!$mailboxConfig) { goto drdyK; } goto j69aQ; jaytm: $this->assign("\x63\x61\155\160\141\x69\147\x6e\x49\156\x66\157\163", $campaignData); goto BNbJE; sWZmJ: $mailbox = ''; goto zCqCl; UTbDT: p15ee: goto V8LFl; M5NNw: $campaignLists = []; goto hlz6Z; Hgre4: xJEow: goto Tj1Ch; zCqCl: if (!$mailboxId) { goto xJEow; } goto T7iE1; pyVSN: $campaignData = $campaignsLogic->loadCampaignData($campaignId); goto BYehc; Ig1gZ: $campaignAttaches[] = ["\156\x61\x6d\x65" => $attaches[$i]["\157\x72\151\147\151\156\141\x6c\137\156\x61\155\145"], "\x73\x69\x7a\x65" => number_format($attaches[$i]["\163\151\172\145"]), "\155\x69\155\x65\x5f\164\171\160\145" => $attaches[$i]["\155\151\155\145\x5f\x74\171\160\145"], "\x64\x65\x73\x63\x72\151\x70\x74\151\x6f\156" => $attaches[$i]["\144\145\x73\x63\x72\151\x70\164\x69\x6f\156"]]; goto NDyve; qTdUH: return $this->fetch(); goto AM8zv; GdvRv: $this->assign("\x63\x61\x6d\x70\x61\151\147\x6e\x4c\151\x73\x74\163", $campaignLists); goto qTdUH; NDyve: G6QAS: goto TGty8; T7iE1: $mailboxesLogic = new \app\index\logic\Mailboxes(); goto dNZhA; FqdGa: $count = count($attaches); goto qOU3I; BYehc: if (!empty($campaignData)) { goto zcNJz; } goto VLck4; AHUer: $campaignAttaches = []; goto a8rjf; AM8zv: } public function campaignDraftListsDetail($campaignId) { goto yKhXR; yKhXR: $campaignListsLogic = CampaignListsLogic::I(); goto QbpTM; jXQwx: $bindValues = ["\163\165\142\163\x63\x72\151\142\x65\162\163" => ["\x74\x6f\164\141\x6c\137\143\157\x75\x6e\x74" => $subscriberInfos["\164\157\164\141\154\137\143\x6f\165\x6e\x74"], "\150\x74\155\154\137\x63\x6f\165\x6e\x74" => $subscriberInfos["\150\164\x6d\154\137\x63\x6f\x75\156\164"], "\164\145\170\x74\x5f\x63\157\165\156\x74" => $subscriberInfos["\x74\145\170\164\137\143\157\x75\156\164"]]]; goto isZyn; k1vZD: return $this->fetch(); goto xAWwy; QbpTM: $subscriberInfos = $campaignListsLogic->getSubscriberInfosUnderCampaign($campaignId); goto jXQwx; isZyn: $this->assign($bindValues); goto k1vZD; xAWwy: } public function campaignListsDetail($campaignId) { goto vATsE; mTLit: $bindValues = ["\x63\141\x6d\x70\141\151\x67\x6e\111\x64" => $campaignId, "\163\165\142\x6a\x65\143\x74" => $campaignData["\163\165\142\x6a\145\143\164"], "\x73\165\x62\x73\143\x72\x69\142\x65\x72\x73" => ["\x74\157\x74\x61\x6c\137\143\x6f\165\156\164" => $subscriberInfos["\164\x6f\x74\141\154\x5f\143\x6f\165\156\x74"], "\x68\164\155\x6c\x5f\143\x6f\x75\x6e\x74" => $subscriberInfos["\x68\164\x6d\x6c\x5f\143\x6f\165\156\x74"], "\x74\x65\170\164\137\x63\157\165\x6e\164" => $subscriberInfos["\164\x65\x78\x74\137\143\x6f\x75\156\x74"]], "\x73\145\156\164" => ["\163\145\x6e\x74\137\x74\x69\x6d\145" => timeDiff($campaignData["\x73\x65\x6e\144\x5f\x65\156\x64\x5f\x74\x69\x6d\x65"], $campaignData["\x73\145\x6e\144\137\163\164\141\x72\x74\x5f\164\151\x6d\145"]), "\x73\x75\x63\143\145\x73\x73\x5f\143\x6f\x75\156\x74" => $campaignData["\x73\x65\x6e\144\x5f\164\x65\x78\x74\x5f\143\157\x75\156\x74"] + $campaignData["\x73\x65\156\144\x5f\x68\x74\x6d\x6c\x5f\x63\x6f\x75\x6e\164"], "\x73\165\x63\143\x65\163\163\x5f\150\x74\155\x6c\137\x63\157\x75\x6e\164" => $campaignData["\x73\x65\x6e\144\x5f\x68\x74\155\x6c\x5f\x63\157\165\x6e\x74"], "\163\165\x63\x63\x65\163\x73\137\164\x65\170\164\137\x63\x6f\x75\x6e\x74" => $campaignData["\163\145\x6e\x64\137\164\145\x78\x74\x5f\x63\157\165\156\164"], "\167\141\x69\x74\151\x6e\147\137\x63\x6f\165\156\164" => Db::table("\x63\x61\x6d\x70\141\151\147\156\x5f\x73\x75\x62\x73\x63\162\151\x62\x65\x72\x73")->where(["\143\141\x6d\x70\x61\x69\x67\156\137\x69\144" => $campaignId, "\x73\x74\141\164\165\163" => IndexDefs::eCampaignSubscriberStatusSubmitted])->count(), "\x6e\x6f\x74\137\163\x65\x6e\x74\x5f\x63\x6f\165\156\x74" => Db::table("\143\x61\155\x70\x61\151\x67\x6e\137\163\x75\142\163\143\162\151\x62\145\162\163")->where(["\143\x61\155\160\x61\x69\x67\x6e\x5f\x69\x64" => $campaignId])->where(function ($query) { $query->where("\x73\164\x61\x74\x75\163", IndexDefs::eCampaignSubscriberStatusInvalidEmail); })->count(), "\146\141\151\154\x5f\163\x65\x6e\164\137\x63\157\x75\156\x74" => Db::table("\143\x61\155\x70\x61\151\147\156\137\x73\165\x62\163\143\162\x69\x62\x65\162\x73")->where(["\143\x61\x6d\160\x61\x69\147\156\x5f\x69\144" => $campaignId, "\163\x74\141\164\165\163" => IndexDefs::eCampaignSubscriberStatusSentFail])->count()], "\146\145\x65\144\x62\141\x63\153" => ["\166\x69\x65\167\x65\144\x5f\143\157\x75\156\164" => $campaignData["\x76\x69\x65\167\145\x64\137\143\157\x75\x6e\x74"], "\x75\156\151\161\165\145\x5f\166\x69\x65\167\145\x64\137\143\157\165\156\164" => Db::table("\x63\141\x6d\x70\141\151\x67\156\137\x73\x75\142\x73\x63\162\x69\142\145\162\163")->where(["\x63\x61\155\160\141\151\x67\x6e\x5f\151\x64" => $campaignId, "\166\x69\x65\167\x65\144" => ["\74\x3e", Defs::DEFAULT_DB_DATETIME_VALUE], "\163\164\141\x74\165\163" => IndexDefs::eCampaignSubscriberStatusSentSuccess])->count(), "\142\x6f\x75\x6e\x63\145\137\143\x6f\x75\156\x74" => $campaignData["\142\157\165\x6e\143\x65\137\143\x6f\165\x6e\x74"]]]; goto M9FGF; owPAL: return $this->fetch(); goto NgsAG; ScXUC: $campaignListsLogic = CampaignListsLogic::I(); goto H0DuA; vATsE: $campaignsLogic = CampaignsLogic::I(); goto myvPE; M9FGF: $this->assign($bindValues); goto BjAtv; BjAtv: Log::write("\163\165\142\152\x65\x63\164\x3a\40" . $campaignData["\163\165\142\x6a\145\x63\x74"], Log::NOTICE); goto owPAL; myvPE: $campaignData = $campaignsLogic->loadCampaignData($campaignId); goto ScXUC; H0DuA: $subscriberInfos = $campaignListsLogic->getSubscriberInfosUnderCampaign($campaignId); goto mTLit; NgsAG: } public function campaignSuspend($campaignId) { goto RLmWS; RLmWS: $campaignListsLogic = CampaignListsLogic::I(); goto hT_H7; hT_H7: $campaignListsLogic->suspendCampaign($campaignId); goto u_YzA; u_YzA: return ajaxSuccess("\346\223\x8d\344\xbd\x9c\346\x88\x90\345\x8a\x9f"); goto jigMT; jigMT: } public function campaignRequeue($campaignId) { goto mJnIt; YATar: return ajaxSuccess("\346\x93\x8d\xe4\275\234\xe6\210\x90\xe5\x8a\237"); goto vOFPt; mJnIt: $campaignListsLogic = CampaignListsLogic::I(); goto sLDOF; sLDOF: $campaignListsLogic->requeueCampaign($campaignId); goto YATar; vOFPt: } public function campaignMarkSent($campaignId) { goto D609q; D609q: $campaignListsLogic = CampaignListsLogic::I(); goto Hfs3g; Hfs3g: $campaignListsLogic->markSentCampaign($campaignId); goto LJZyB; LJZyB: return ajaxSuccess("\xe6\x93\x8d\344\xbd\234\xe6\210\220\345\x8a\237"); goto wrP3_; wrP3_: } }
