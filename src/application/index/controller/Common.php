<?php
 namespace app\index\controller; use think\Controller; use think\Session; use think\Cookie; use think\Request; use think\Log; use app\index\service\RequestContext; use crypt\PhpEncrypter; use app\index\logic\Admins as AdminsLogic; class Common extends Controller { protected $loginUserType = null; protected $loginUserId = null; protected $loginUserName = null; protected $loginRealName = null; protected $loginUserRoleId = null; protected $loginSuperUser = false; protected $loginTime = null; protected $loginIp = null; protected $loginMobile = null; protected function _initialize() { goto AjzaT; KsOsF: $this->loginRealName = Session::get("\162\x65\141\x6c\156\x61\x6d\145"); goto ESpej; QruGp: RequestContext::I()->loginUserId = $this->loginUserId; goto El1Cf; ESpej: $this->loginUserRoleId = Session::get("\165\x73\x65\x72\x72\x6f\154\145\151\144"); goto cGF6s; I1Dru: $this->loginSuperUser = Session::get("\x73\165\160\x65\x72\137\165\163\145\x72"); goto KWBKS; wuHnT: RequestContext::I()->loginMobile = $this->loginMobile; goto J4QqI; zHKis: $this->assign("\154\x6f\147\x69\156\115\157\142\151\154\x65", $this->loginMobile); goto nlttm; XOEt7: RequestContext::I()->loginUserType = $this->loginUserType; goto QruGp; Eoy3i: RequestContext::I()->loginSuperUser = $this->loginSuperUser; goto wuHnT; cGF6s: $this->loginTime = Session::get("\x6c\141\x73\164\154\157\147\151\156\x74\x69\155\x65"); goto JjtHZ; RXFNo: $this->assign("\154\x6f\x67\151\x6e\x55\163\x65\x72\124\x79\160\x65", $this->loginUserType); goto zHKis; JjtHZ: $this->loginIp = Session::get("\x6c\x61\163\164\x6c\157\147\151\156\151\x70"); goto I1Dru; mRHPN: RequestContext::I()->loginUserRoleId = $this->loginUserRoleId; goto wGrf3; AjzaT: $this->loginUserType = Session::get("\x75\x73\x65\162\x74\171\160\x65"); goto RorWe; wGrf3: RequestContext::I()->loginTime = $this->loginTime; goto NJNHx; p7Lf0: $this->loginUserName = Session::get("\165\x73\x65\x72\x6e\141\155\x65"); goto KsOsF; El1Cf: RequestContext::I()->loginUserName = $this->loginUserName; goto mRHPN; RorWe: $this->loginUserId = Session::get("\165\x73\x65\x72\x69\144"); goto p7Lf0; KWBKS: $this->loginMobile = request()->isMobile(); goto XOEt7; J4QqI: self::checkLogin(); goto RXFNo; nlttm: $this->assign("\137\162\x65\x71\x75\x65\163\x74\137\165\x72\154", $this->request->url()); goto rlh2k; NJNHx: RequestContext::I()->loginIp = $this->loginIp; goto Eoy3i; rlh2k: } const AUTO_LOGIN_ENCRYPT_PASS = "\x68\145\154\x6c\x6f\x31\62\x33\x29\x28\52"; protected function autoLogin() { goto MdBWC; wAyR1: try { AdminsLogic::I()->login($username, $password); } catch (\Exception $e) { return false; } goto lAAW1; ECNq5: $token = $crypt->decrypt($autoLoginToken, self::AUTO_LOGIN_ENCRYPT_PASS); goto Lkwof; lAAW1: Log::notice("\x61\x75\164\157\114\157\147\151\x6e\x20\x73\165\x63\143\145\163\x73"); goto iAWSX; iAWSX: return true; goto kbmK_; r6NsR: RTjZw: goto BiXQ0; BiXQ0: $crypt = new PhpEncrypter(); goto ECNq5; J3yKh: return false; goto r6NsR; NsuGu: if ($autoLoginToken) { goto RTjZw; } goto J3yKh; MdBWC: $autoLoginToken = Cookie::get("\x61\x75\x74\x6f\137\x6c\x6f\147\x69\x6e\137\x74\x6f\153\x65\156"); goto NsuGu; Lkwof: list($username, $password) = explode("\43\52\43\52\43\x2a", $token); goto wAyR1; kbmK_: } protected function autoLoginToken($username, $password) { goto mTAv4; nbom7: $autoLoginToken = $crypt->encrypt($username . "\x23\52\x23\x2a\43\x2a" . $password, self::AUTO_LOGIN_ENCRYPT_PASS); goto dLKwY; mTAv4: $crypt = new PhpEncrypter(); goto nbom7; dLKwY: return $autoLoginToken; goto GRFL3; GRFL3: } public final function checkLogin() { goto pd9Sj; CQ3Po: if (!($controller == "\111\156\144\x65\170" && in_array($action, array("\154\157\147\151\156", "\x6c\x6f\147\157\165\164", "\143\141\x70\x74\x63\x68\x61")))) { goto NxM8h; } goto e7_4c; l_jze: $this->redirect("\151\x6e\x64\145\x78\x2f\x49\156\x64\x65\x78\57\x6c\x6f\147\151\156"); goto b1xZe; Kv6dd: me9EB: goto WqLFO; t1X3_: goto OU_4r; goto d19jO; pd9Sj: $controller = Request::instance()->controller(); goto tzaaF; rMZGZ: Ih21C: goto Ouvac; Ouvac: Log::notice("\x43\x6f\155\155\157\x6e\103\157\156\x74\162\157\154\154\x65\162\72\x3a\143\150\145\x63\153\x41\x64\155\151\x6e\54\40\x70\154\145\x61\163\x65\x20\x6c\157\147\x69\x6e\x20\146\x69\162\163\x74\154\x79\54\x20\x73\x65\x73\163\x69\157\156\x3a\40" . var_export($_SERVER, true) . "\54\40\165\x72\154\x3a" . url("\x69\x6e\144\145\x78\57\111\156\x64\145\x78\x2f\154\x6f\x67\151\x6e")); goto l_jze; b1xZe: AqExY: goto t1X3_; f_3ZF: NxM8h: goto dgeY6; Yhyvd: return true; goto Kv6dd; maSQS: if (!request()->isAjax()) { goto Ih21C; } goto hit1m; e7_4c: return true; goto f_3ZF; d19jO: IRQfm: goto kjI7u; SmnPA: goto AqExY; goto rMZGZ; kjI7u: header("\110\x54\124\x50\57\x31\56\x31\x20\x34\60\61\40\x55\x6e\141\165\x74\x68\157\162\151\x7a\145\144"); goto I4ZH_; svztc: if (!$this->loginUserId) { goto me9EB; } goto Yhyvd; I4ZH_: exit; goto Yg2FM; dgeY6: $loginUrl = url("\151\x6e\x64\145\170\57\x49\156\144\x65\170\x2f\154\x6f\x67\151\156"); goto svztc; hit1m: exit; goto SmnPA; tzaaF: $action = Request::instance()->action(); goto CQ3Po; Yg2FM: OU_4r: goto NX2Lc; WqLFO: if (request()->isAjax()) { goto IRQfm; } goto maSQS; NX2Lc: } }
